

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Examples &mdash; VegasAfterglow 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=20074c1a" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c0df17a3" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c0df17a3" />

  
    <link rel="shortcut icon" href="_static/logo.svg"/>
    <link rel="canonical" href="https://yihanwangastro.github.io/VegasAfterglow/docs/examples.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/js/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MCMC Parameter Fitting" href="mcmc_fitting.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VegasAfterglow
              <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-simple-afterglow-model">Setting up a simple afterglow model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-flux-on-time-frequency-pairs">Calculate flux on time-frequency pairs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-flux-with-exposure-time-averaging">Calculate flux with exposure time averaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-bolometric-flux-frequency-integrated">Calculate bolometric flux (frequency-integrated)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ambient-media-models">Ambient Media Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wind-medium">Wind Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stratified-medium">Stratified Medium</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-medium">User-Defined Medium</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jet-models">Jet Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gaussian-jet">Gaussian Jet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-law-jet">Power-Law Jet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-component-jet">Two-Component Jet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-power-law-jet">Step Power-Law Jet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jet-with-spreading">Jet with Spreading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#magnetar-spin-down">Magnetar Spin-down</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-jet">User-Defined Jet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#radiation-processes">Radiation Processes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reverse-shock-emission">Reverse Shock Emission</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inverse-compton-cooling">Inverse Compton Cooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#self-synchrotron-compton-radiation">Self-Synchrotron Compton Radiation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-configuration-introspection">Model Configuration Introspection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#jet-property-introspection">Jet Property Introspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#medium-density-introspection">Medium Density Introspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-component-jet-analysis">Two-Component Jet Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mcmc_fitting.html">MCMC Parameter Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="redback_integration.html">Parameter Estimation with Redback</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_reference.html">Parameter Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation &amp; Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_api.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VegasAfterglow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#basic-usage" id="id1">Basic Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-a-simple-afterglow-model" id="id2">Setting up a simple afterglow model</a></p></li>
<li><p><a class="reference internal" href="#calculate-flux-on-time-frequency-pairs" id="id3">Calculate flux on time-frequency pairs</a></p></li>
<li><p><a class="reference internal" href="#calculate-flux-with-exposure-time-averaging" id="id4">Calculate flux with exposure time averaging</a></p></li>
<li><p><a class="reference internal" href="#calculate-bolometric-flux-frequency-integrated" id="id5">Calculate bolometric flux (frequency-integrated)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#ambient-media-models" id="id6">Ambient Media Models</a></p>
<ul>
<li><p><a class="reference internal" href="#wind-medium" id="id7">Wind Medium</a></p></li>
<li><p><a class="reference internal" href="#stratified-medium" id="id8">Stratified Medium</a></p></li>
<li><p><a class="reference internal" href="#user-defined-medium" id="id9">User-Defined Medium</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#jet-models" id="id10">Jet Models</a></p>
<ul>
<li><p><a class="reference internal" href="#gaussian-jet" id="id11">Gaussian Jet</a></p></li>
<li><p><a class="reference internal" href="#power-law-jet" id="id12">Power-Law Jet</a></p></li>
<li><p><a class="reference internal" href="#two-component-jet" id="id13">Two-Component Jet</a></p></li>
<li><p><a class="reference internal" href="#step-power-law-jet" id="id14">Step Power-Law Jet</a></p></li>
<li><p><a class="reference internal" href="#jet-with-spreading" id="id15">Jet with Spreading</a></p></li>
<li><p><a class="reference internal" href="#magnetar-spin-down" id="id16">Magnetar Spin-down</a></p></li>
<li><p><a class="reference internal" href="#user-defined-jet" id="id17">User-Defined Jet</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#radiation-processes" id="id18">Radiation Processes</a></p>
<ul>
<li><p><a class="reference internal" href="#reverse-shock-emission" id="id19">Reverse Shock Emission</a></p></li>
<li><p><a class="reference internal" href="#inverse-compton-cooling" id="id20">Inverse Compton Cooling</a></p></li>
<li><p><a class="reference internal" href="#self-synchrotron-compton-radiation" id="id21">Self-Synchrotron Compton Radiation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#model-configuration-introspection" id="id22">Model Configuration Introspection</a></p>
<ul>
<li><p><a class="reference internal" href="#jet-property-introspection" id="id23">Jet Property Introspection</a></p></li>
<li><p><a class="reference internal" href="#medium-density-introspection" id="id24">Medium Density Introspection</a></p></li>
<li><p><a class="reference internal" href="#two-component-jet-analysis" id="id25">Two-Component Jet Analysis</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="basic-usage">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Basic Usage</a><a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h2>
<section id="setting-up-a-simple-afterglow-model">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Setting up a simple afterglow model</a><a class="headerlink" href="#setting-up-a-simple-afterglow-model" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ISM</span><span class="p">,</span> <span class="n">TophatJet</span><span class="p">,</span> <span class="n">Observer</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Model</span>

<span class="c1"># Define the circumburst environment (constant density ISM)</span>
<span class="n">medium</span> <span class="o">=</span> <span class="n">ISM</span><span class="p">(</span><span class="n">n_ism</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Configure the jet structure (top-hat with opening angle, energy, and Lorentz factor)</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TophatJet</span><span class="p">(</span><span class="n">theta_c</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="c1"># Set observer parameters (distance, redshift, viewing angle)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">(</span><span class="n">lumi_dist</span><span class="o">=</span><span class="mf">1e26</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta_obs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Define radiation microphysics parameters</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">xi_e</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Combine all components into a complete afterglow model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="n">medium</span><span class="o">=</span><span class="n">medium</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">fwd_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span> <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Define time range for light curve calculation</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># Define observing frequencies (radio, optical, X-ray bands in Hz)</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e14</span><span class="p">,</span> <span class="mf">1e17</span><span class="p">])</span>

<span class="c1"># Calculate the afterglow emission at each time and frequency</span>
<span class="c1"># NOTE that the times array needs to be in ascending order</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux_density_grid</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>

<span class="c1"># Visualize the multi-wavelength light curves</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.8</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># Plot each frequency band</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ Hz&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux Density (erg/cm²/s/Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Define broad frequency range (10⁵ to 10²² Hz)</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># Select specific time epochs for spectral snapshots</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e5</span> <span class="p">,</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">1e7</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">])</span>

<span class="c1"># Calculate spectra at each epoch</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux_density_grid</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">)</span>

<span class="c1"># Plot broadband spectra at each epoch</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.8</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">total</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ s&#39;</span><span class="p">)</span>

<span class="c1"># Add vertical lines marking the bands from the light curve plot</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">band</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">band</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;flux density (erg/cm²/s/Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Synchrotron Spectra&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="calculate-flux-on-time-frequency-pairs">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Calculate flux on time-frequency pairs</a><a class="headerlink" href="#calculate-flux-on-time-frequency-pairs" title="Link to this heading"></a></h3>
<p>Suppose you want to calculate the flux at specific time-frequency pairs (t_i, nu_i) instead of a grid (t_i, nu_j), you can use the following method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define time range for light curve calculation</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># Define observing frequencies (must be the same length as times)</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux_density</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span> <span class="c1">#times array must be in ascending order</span>

<span class="c1"># the returned results is a FluxDict object with arrays of the same shape as the input times and bands.</span>
</pre></div>
</div>
</section>
<section id="calculate-flux-with-exposure-time-averaging">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Calculate flux with exposure time averaging</a><a class="headerlink" href="#calculate-flux-with-exposure-time-averaging" title="Link to this heading"></a></h3>
<p>For observations with finite exposure times, you can calculate time-averaged flux by sampling multiple points within each exposure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define observation times (start of exposure)</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Define observing frequencies (must be the same length as times)</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Define exposure times for each observation (in seconds)</span>
<span class="n">expo_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># 100-second exposures</span>

<span class="c1"># Calculate time-averaged flux with 20 sample points per exposure</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux_density_exposures</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">expo_time</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># The returned results is a FluxDict object with arrays of the same shape as input times and bands</span>
<span class="c1"># Each flux value represents the average over the corresponding exposure time</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function samples <code class="xref any docutils literal notranslate"><span class="pre">num_points</span></code> evenly spaced within each exposure time and averages the computed flux. Higher <code class="xref any docutils literal notranslate"><span class="pre">num_points</span></code> gives more accurate time averaging but increases computation time. The minimum value is 2.</p>
</div>
</section>
<section id="calculate-bolometric-flux-frequency-integrated">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Calculate bolometric flux (frequency-integrated)</a><a class="headerlink" href="#calculate-bolometric-flux-frequency-integrated" title="Link to this heading"></a></h3>
<p>For broadband flux measurements integrated over a frequency range (e.g., instrument bandpasses like Swift/BAT, Fermi/LAT):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define time range for broadband light curve calculation</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Example 1: Swift/BAT bandpass (15-150 keV ≈ 3.6e18 - 3.6e19 Hz)</span>
<span class="n">nu_min_bat</span> <span class="o">=</span> <span class="mf">3.6e18</span>  <span class="c1"># Lower frequency bound [Hz]</span>
<span class="n">nu_max_bat</span> <span class="o">=</span> <span class="mf">3.6e19</span>  <span class="c1"># Upper frequency bound [Hz]</span>
<span class="n">num_points</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># Number of frequency sampling points for integration</span>

<span class="c1"># Calculate frequency-integrated flux</span>
<span class="n">flux_bat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nu_min_bat</span><span class="p">,</span> <span class="n">nu_max_bat</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>

<span class="c1"># Example 2: Custom optical band (V-band: 5.1e14 ± 5e13 Hz)</span>
<span class="n">nu_min_v</span> <span class="o">=</span> <span class="mf">4.6e14</span>    <span class="c1"># V-band lower edge [Hz]</span>
<span class="n">nu_max_v</span> <span class="o">=</span> <span class="mf">5.6e14</span>    <span class="c1"># V-band upper edge [Hz]</span>
<span class="n">flux_v</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">nu_min_v</span><span class="p">,</span> <span class="n">nu_max_v</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>

<span class="c1"># Plot broadband light curves</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">flux_bat</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Swift/BAT (15-150 keV)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">flux_v</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;V-band optical&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Integrated Flux [erg/cm²/s]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Broadband Light Curves&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>When to use `flux` vs `flux_density_grid`:</strong></p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">flux()</span></code> for broadband flux measurements (instrument bandpasses, bolometric calculations)</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">flux_density_grid()</span></code> for monochromatic flux densities at specific frequencies</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">flux()</span></code> method integrates over frequency, so units are [erg/cm²/s] instead of [erg/cm²/s/Hz]</p></li>
<li><p>Higher <code class="docutils literal notranslate"><span class="pre">num_points</span></code> gives more accurate frequency integration but increases computation time</p></li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Frequency Integration Guidelines:</strong></p>
<ul class="simple">
<li><p><strong>Narrow bands</strong> (Δν/ν &lt; 0.5): Use <code class="docutils literal notranslate"><span class="pre">num_points</span> <span class="pre">=</span> <span class="pre">5-10</span></code></p></li>
<li><p><strong>Wide bands</strong> (Δν/ν &gt; 1): Use <code class="docutils literal notranslate"><span class="pre">num_points</span> <span class="pre">=</span> <span class="pre">20-50</span></code></p></li>
<li><p><strong>Very wide bands</strong> (multiple decades): Use <code class="docutils literal notranslate"><span class="pre">num_points</span> <span class="pre">=</span> <span class="pre">50+</span></code></p></li>
<li><p>Monitor convergence by testing different <code class="docutils literal notranslate"><span class="pre">num_points</span></code> values</p></li>
</ul>
</div>
</section>
</section>
<section id="ambient-media-models">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Ambient Media Models</a><a class="headerlink" href="#ambient-media-models" title="Link to this heading"></a></h2>
<section id="wind-medium">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Wind Medium</a><a class="headerlink" href="#wind-medium" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Wind</span>

<span class="c1"># Create a stellar wind medium</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">Wind</span><span class="p">(</span><span class="n">A_star</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># A* parameter</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">medium</span><span class="o">=</span><span class="n">wind</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="stratified-medium">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Stratified Medium</a><a class="headerlink" href="#stratified-medium" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Wind</span>

<span class="c1"># Create a stratified stellar wind medium;</span>
<span class="c1"># smooth transited stratified medium. Inner region, n(r) = n0, middle region n(r) \propto 1/r^2, outer region n(r)=n_ism</span>
<span class="c1"># A = 0 (default): fallback to n = n_ism</span>
<span class="c1"># n0 = inf (default): wind bubble, from wind profile to ism profile</span>
<span class="c1"># A = 0 &amp; n0 = inf: pure wind;</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">Wind</span><span class="p">(</span><span class="n">A_star</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n_ism</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n0</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">medium</span><span class="o">=</span><span class="n">wind</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="user-defined-medium">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">User-Defined Medium</a><a class="headerlink" href="#user-defined-medium" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Medium</span>

<span class="n">mp</span> <span class="o">=</span> <span class="mf">1.67e-24</span> <span class="c1"># proton mass in gram</span>

<span class="c1"># Define a custom density profile function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">density</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span><span class="c1"># r in cm, phi and theta in radians [scalar]</span>
    <span class="k">return</span> <span class="n">mp</span> <span class="c1"># n_ism =  1 cm^-3</span>
    <span class="c1">#return whatever density profile (g*cm^-3) you want as a function of phi, theta, and r</span>

<span class="c1"># Create a user-defined medium</span>
<span class="n">medium</span> <span class="o">=</span> <span class="n">Medium</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">medium</span><span class="o">=</span><span class="n">medium</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="jet-models">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Jet Models</a><a class="headerlink" href="#jet-models" title="Link to this heading"></a></h2>
<section id="gaussian-jet">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Gaussian Jet</a><a class="headerlink" href="#gaussian-jet" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianJet</span>

<span class="c1"># Create a structured jet with Gaussian energy profile</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">GaussianJet</span><span class="p">(</span>
    <span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>         <span class="c1"># Core angular size (radians)</span>
    <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span>           <span class="c1"># Isotropic-equivalent energy (ergs)</span>
    <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span>            <span class="c1"># Initial Lorentz factor</span>
<span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="power-law-jet">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Power-Law Jet</a><a class="headerlink" href="#power-law-jet" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">PowerLawJet</span>

<span class="c1"># Create a power-law structured jet</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">PowerLawJet</span><span class="p">(</span>
    <span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>         <span class="c1"># Core angular size (radians)</span>
    <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span>           <span class="c1"># Isotropic-equivalent energy (ergs)</span>
    <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>           <span class="c1"># Initial Lorentz factor</span>
    <span class="n">k_e</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>              <span class="c1"># Power-law index for energy angular dependence</span>
    <span class="n">k_g</span><span class="o">=</span><span class="mf">2.0</span>               <span class="c1"># Power-law index for Lorentz factor angular dependence</span>
<span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="two-component-jet">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Two-Component Jet</a><a class="headerlink" href="#two-component-jet" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwoComponentJet</span>

<span class="c1"># Create a two-component jet</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TwoComponentJet</span><span class="p">(</span>
    <span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>        <span class="c1"># Narrow component angular size (radians)</span>
    <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span>          <span class="c1"># Isotropic-equivalent energy of the narrow component (ergs)</span>
    <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>          <span class="c1"># Initial Lorentz factor of the narrow component</span>
    <span class="n">theta_w</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>         <span class="c1"># Wide component angular size (radians)</span>
    <span class="n">E_iso_w</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span>        <span class="c1"># Isotropic-equivalent energy of the wide component (ergs)</span>
    <span class="n">Gamma0_w</span><span class="o">=</span><span class="mi">100</span>         <span class="c1"># Initial Lorentz factor of the wide component</span>
<span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-power-law-jet">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Step Power-Law Jet</a><a class="headerlink" href="#step-power-law-jet" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">StepPowerLawJet</span>

<span class="c1"># Create a step power-law structured jet (uniform core with sharp transition)</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">StepPowerLawJet</span><span class="p">(</span>
    <span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>        <span class="c1"># Core angular size (radians)</span>
    <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span>          <span class="c1"># Isotropic-equivalent energy of the core component (ergs)</span>
    <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>          <span class="c1"># Initial Lorentz factor of the core component</span>
    <span class="n">E_iso_w</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span>        <span class="c1"># Isotropic-equivalent energy of the wide component (ergs)</span>
    <span class="n">Gamma0_w</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>        <span class="c1"># Initial Lorentz factor of the wide component</span>
    <span class="n">k_e</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>             <span class="c1"># Power-law index for energy angular dependence</span>
    <span class="n">k_g</span><span class="o">=</span><span class="mf">2.0</span>              <span class="c1"># Power-law index for Lorentz factor angular dependence</span>
<span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="jet-with-spreading">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Jet with Spreading</a><a class="headerlink" href="#jet-with-spreading" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TophatJet</span>

<span class="n">jet</span> <span class="o">=</span> <span class="n">TophatJet</span><span class="p">(</span>
    <span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span>
    <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">spreading</span><span class="o">=</span><span class="kc">True</span>       <span class="c1"># Enable spreading</span>
<span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The jet spreading (Lateral Expansion) is experimental and only works for the top-hat jet, Gaussian jet, and power-law jet with a jet core.
The spreading prescription may not work for arbitrary user-defined jet structures.</p>
</div>
</section>
<section id="magnetar-spin-down">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Magnetar Spin-down</a><a class="headerlink" href="#magnetar-spin-down" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Magnetar</span>

<span class="c1"># Create a tophat jet with magnetar spin-down energy injection; Luminosity 1e46 erg/s, t_0 = 100 seconds, and q = 2</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TophatJet</span><span class="p">(</span><span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">magnetar</span><span class="o">=</span><span class="n">Magnetar</span><span class="p">(</span><span class="n">L0</span><span class="o">=</span><span class="mf">1e46</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The magnetar spin-down injection is implemented in the default form L0*(1+t/t0)^(-q) for theta &lt; theta_c. You can pass the <code class="xref any docutils literal notranslate"><span class="pre">magnetar</span></code> argument to the power-law and Gaussian jet as well.</p>
</div>
</section>
<section id="user-defined-jet">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">User-Defined Jet</a><a class="headerlink" href="#user-defined-jet" title="Link to this heading"></a></h3>
<p>You may also define your own jet structure by providing the energy and lorentz factor profile.
Those two profiles are required to complete a jet structure. You may also provide the magnetization profile, enregy injection profile, and mass injection profile.
Those profiles are optional and will be set to zero function if not provided.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ejecta</span>

<span class="c1"># Define a custom energy profile function, required to complete the jet structure</span>
<span class="k">def</span><span class="w"> </span><span class="nf">E_iso_profile</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1e53</span>  <span class="c1"># E_iso = 1e53 erg isotropic fireball</span>
    <span class="c1">#return whatever energy profile you want as a function of phi and theta in unit of erg [not erg per solid angle]</span>

<span class="c1"># Define a custom lorentz factor profile function, required to complete the jet structure</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Gamma0_profile</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">300</span> <span class="c1"># Gamma0 = 300</span>
    <span class="c1">#return whatever lorentz factor profile you want as a function of phi and theta</span>

<span class="c1"># Define a custom magnetization profile function, optional</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sigma0_profile</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.1</span> <span class="c1"># sigma = 0.1</span>
    <span class="c1">#return whatever magnetization profile you want as a function of phi and theta</span>

<span class="c1"># Define a custom energy injection profile function, optional</span>
<span class="k">def</span><span class="w"> </span><span class="nf">E_dot_profile</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1e46</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># L = 1e46 erg/s, t0 = 100 seconds</span>
    <span class="c1">#return whatever energy injection  profile you want as a function of phi, theta, and time in unit of erg/s [not erg/s per solid angle]</span>

<span class="c1"># Define a custom mass injection profile function, optional</span>
<span class="k">def</span><span class="w"> </span><span class="nf">M_dot_profile</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1">#return whatever mass injection profile you want as a function of phi, theta, and time in unit of g/s [not g/s per solid angle]</span>

<span class="c1"># Create a user-defined jet</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">Ejecta</span><span class="p">(</span><span class="n">E_iso</span><span class="o">=</span><span class="n">E_iso_profile</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="n">Gamma0_profile</span><span class="p">,</span> <span class="n">sigma0</span><span class="o">=</span><span class="n">sigma0_profile</span><span class="p">,</span> <span class="n">E_dot</span><span class="o">=</span><span class="n">E_dot_profile</span><span class="p">,</span> <span class="n">M_dot</span><span class="o">=</span><span class="n">M_dot_profile</span><span class="p">)</span>

<span class="c1">#..other settings</span>

<span class="c1">#if your jet is not axisymmetric, set axisymmetric to False</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">axisymmetric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># the user-defined jet structure could be spiky, the default resolution may not resolve the jet structure. if that is the case, you can try a finer resolution (phi_ppd, theta_ppd, t_ppd)</span>
<span class="c1"># where phi_ppd is the number of points per degree in the phi direction, theta_ppd is the number of points per degree in the theta direction, and t_ppd is the number of points per decade in the time direction    .</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting user-defined structured jet in the Python level is OK for light curve and spectrum calculation. However, it is not recommended for MCMC parameter fitting if you do care about the performance.
The reason is that setting user-defined profiles in the Python level leads to a large overhead due to the Python-C++ inter-process communication.
Users are recommended to set up the user-defined jet structure in the C++ level for MCMC parameter fitting for better performance, if you want the best performance.</p>
</div>
</section>
</section>
<section id="radiation-processes">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Radiation Processes</a><a class="headerlink" href="#radiation-processes" title="Link to this heading"></a></h2>
<section id="reverse-shock-emission">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Reverse Shock Emission</a><a class="headerlink" href="#reverse-shock-emission" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Radiation</span>

<span class="c1">#set the jet duration to be 100 seconds, the default is 1 second. The jet duration affects the reverse shock thickness (thin shell or thick shell).</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TophatJet</span><span class="p">(</span><span class="n">theta_c</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Create a radiation model with both forward and reverse shock synchrotron radiation</span>
<span class="n">fwd_rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">)</span>
<span class="n">rvs_rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.4</span><span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">fwd_rad</span><span class="o">=</span><span class="n">fwd_rad</span><span class="p">,</span> <span class="n">rvs_rad</span><span class="o">=</span><span class="n">rvs_rad</span><span class="p">,</span> <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span><span class="o">...</span><span class="p">)</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e14</span><span class="p">,</span> <span class="mf">1e17</span><span class="p">])</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux_density_grid</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.8</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># Plot each frequency band</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fwd</span><span class="o">.</span><span class="n">sync</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ Hz (fwd)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">rvs</span><span class="o">.</span><span class="n">sync</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ Hz (rvs)&#39;</span><span class="p">)</span><span class="c1">#reverse shock synchrotron</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may increase the resolution of the grid to improve the accuracy of the reverse shock synchrotron radiation if you see spiky features.</p>
</div>
</section>
<section id="inverse-compton-cooling">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Inverse Compton Cooling</a><a class="headerlink" href="#inverse-compton-cooling" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Radiation</span>

<span class="c1"># Create a radiation model with inverse Compton cooling (without Klein-Nishina correction) on synchrotron radiation</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">ssc_cooling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">fwd_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="self-synchrotron-compton-radiation">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Self-Synchrotron Compton Radiation</a><a class="headerlink" href="#self-synchrotron-compton-radiation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Radiation</span>

<span class="c1"># Create a radiation model with self-Compton radiation</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">ssc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ssc_cooling</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#..other settings</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">fwd_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e14</span><span class="p">,</span> <span class="mf">1e17</span><span class="p">])</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">flux_density_grid</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.8</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># Plot each frequency band</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fwd</span><span class="o">.</span><span class="n">sync</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ Hz (sync)&#39;</span><span class="p">)</span><span class="c1">#synchrotron</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fwd</span><span class="o">.</span><span class="n">ssc</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ Hz (SSC)&#39;</span><span class="p">)</span><span class="c1">#SSC</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(ssc_cooling = False, kn = False, ssc = True): The IC radiation is calculated based on synchrotron spectrum without IC cooling.</p>
<p>(ssc_cooling = True, kn = False, ssc = True): The IC radiation is calculated based on synchrotron spectrum with IC cooling, but without Klein-Nishina correction.</p>
<p>(ssc_cooling = True, kn = True, ssc = True): The IC radiation is calculated based on synchrotron spectrum with both IC cooling and Klein-Nishina correction.</p>
</div>
</section>
</section>
<section id="model-configuration-introspection">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">Model Configuration Introspection</a><a class="headerlink" href="#model-configuration-introspection" title="Link to this heading"></a></h2>
<p>VegasAfterglow provides introspection methods to examine jet and medium properties at specific coordinates. These methods are useful for understanding model configuration, validating parameters, and creating diagnostic plots.</p>
<section id="jet-property-introspection">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Jet Property Introspection</a><a class="headerlink" href="#jet-property-introspection" title="Link to this heading"></a></h3>
<p>You can examine the angular dependence of jet properties using the <code class="docutils literal notranslate"><span class="pre">jet_E_iso</span></code> and <code class="docutils literal notranslate"><span class="pre">jet_Gamma0</span></code> methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">PowerLawJet</span><span class="p">,</span> <span class="n">ISM</span><span class="p">,</span> <span class="n">Observer</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Model</span>

<span class="c1"># Create a power-law jet for demonstration</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">PowerLawJet</span><span class="p">(</span><span class="n">theta_c</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">k_e</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">k_g</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">medium</span> <span class="o">=</span> <span class="n">ISM</span><span class="p">(</span><span class="n">n_ism</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">(</span><span class="n">lumi_dist</span><span class="o">=</span><span class="mf">1e26</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta_obs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="n">medium</span><span class="o">=</span><span class="n">medium</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">fwd_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>

<span class="c1"># Define angular coordinates</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Azimuthal angle (for axisymmetric jets, phi doesn&#39;t matter)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Polar angles from 0 to 0.5 radians</span>

<span class="c1"># Get jet properties</span>
<span class="n">E_iso_profile</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">jet_E_iso</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>  <span class="c1"># Isotropic energy [erg]</span>
<span class="n">Gamma0_profile</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">jet_Gamma0</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>  <span class="c1"># Initial Lorentz factor</span>

<span class="c1"># Create visualization</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Plot energy profile</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">E_iso_profile</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polar Angle [degrees]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_{\rm iso}$ [erg]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Jet Energy Profile&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Plot Lorentz factor profile</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">Gamma0_profile</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polar Angle [degrees]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma_0$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Jet Lorentz Factor Profile&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="medium-density-introspection">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Medium Density Introspection</a><a class="headerlink" href="#medium-density-introspection" title="Link to this heading"></a></h3>
<p>You can examine the radial dependence of medium density using the <code class="docutils literal notranslate"><span class="pre">medium</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">Wind</span>

<span class="c1"># Create a wind medium for demonstration</span>
<span class="n">wind</span> <span class="o">=</span> <span class="n">Wind</span><span class="p">(</span><span class="n">A_star</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n_ism</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Note: This creates a stratified wind: inner constant density n0,</span>
<span class="c1"># middle r^-2 profile, outer constant density n_ism</span>

<span class="c1"># Create model with wind medium</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="n">medium</span><span class="o">=</span><span class="n">wind</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">fwd_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>

<span class="c1"># Define radial coordinates</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># 0.1 radians off-axis</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Radii from 10^15 to 10^20 cm</span>

<span class="c1"># Get medium density profile</span>
<span class="n">rho_profile</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">medium</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>  <span class="c1"># Density [g/cm³]</span>

<span class="c1"># Convert to number density (assuming pure hydrogen)</span>
<span class="n">n_profile</span> <span class="o">=</span> <span class="n">rho_profile</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.67e-24</span><span class="p">)</span>  <span class="c1"># [cm^-3]</span>

<span class="c1"># Create visualization</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n_profile</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Radius [cm]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Number Density [cm$^{-3}$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Medium Density Profile&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add annotations for different regions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Inner constant density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Outer ISM density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="two-component-jet-analysis">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Two-Component Jet Analysis</a><a class="headerlink" href="#two-component-jet-analysis" title="Link to this heading"></a></h3>
<p>For complex jet structures like two-component jets, introspection is particularly useful:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">TwoComponentJet</span>

<span class="c1"># Create a two-component jet</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TwoComponentJet</span><span class="p">(</span>
    <span class="n">theta_c</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>    <span class="c1"># Narrow component</span>
    <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e53</span><span class="p">,</span>
    <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">theta_w</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>    <span class="c1"># Wide component</span>
    <span class="n">E_iso_w</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span>
    <span class="n">Gamma0_w</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="n">medium</span><span class="o">=</span><span class="n">medium</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">fwd_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>

<span class="c1"># Examine the jet structure</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">E_iso_profile</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">jet_E_iso</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
<span class="n">Gamma0_profile</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">jet_Gamma0</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

<span class="c1"># Create detailed visualization</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Energy profile</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">E_iso_profile</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Core boundary&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">0.15</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wide component boundary&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$E_{\rm iso}$ [erg]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Two-Component Jet: Energy Profile&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Lorentz factor profile</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">Gamma0_profile</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">0.05</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Core boundary&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">0.15</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Wide component boundary&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polar Angle [degrees]&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Gamma_0$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Two-Component Jet: Lorentz Factor Profile&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>These introspection methods are essential for:</p>
<ul class="simple">
<li><p><strong>Model validation</strong>: Ensuring jet and medium configurations match your intentions</p></li>
<li><p><strong>Parameter studies</strong>: Understanding how changes in parameters affect the structure</p></li>
<li><p><strong>Publication plots</strong>: Creating clean visualizations of model configurations</p></li>
<li><p><strong>Debugging</strong>: Identifying issues with complex multi-component setups</p></li>
<li><p><strong>Physical understanding</strong>: Gaining insight into the initial conditions of your simulations</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mcmc_fitting.html" class="btn btn-neutral float-right" title="MCMC Parameter Fitting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, VegasAfterglow Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>