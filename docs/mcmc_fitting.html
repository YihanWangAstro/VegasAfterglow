

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MCMC Parameter Fitting &mdash; VegasAfterglow 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=20074c1a" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c0df17a3" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c0df17a3" />

  
    <link rel="shortcut icon" href="_static/logo.svg"/>
    <link rel="canonical" href="https://yihanwangastro.github.io/VegasAfterglow/docs/mcmc_fitting.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="_static/js/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parameter Estimation with Redback" href="redback_integration.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VegasAfterglow
              <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MCMC Parameter Fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mcmc-best-practices">MCMC Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-simple-add-complexity-gradually">Start Simple, Add Complexity Gradually</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-complex-models-are-problematic">Why Complex Models Are Problematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-to-use-complex-models">When to Use Complex Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#basic-setup">Basic Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-observational-data">Setting up Observational Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-selection-and-optimization">Data Selection and Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-configuration">Global Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-configurations">Model Configurations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-setup-default">Basic Setup (Default)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jet-structure-variations">Jet Structure Variations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#medium-type-variations">Medium Type Variations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reverse-shock">Reverse Shock</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inverse-compton-radiation">Inverse Compton Radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#energy-injection">Energy Injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complex-model-combinations">Complex Model Combinations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-mcmc">Running MCMC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#choosing-a-sampler">Choosing a Sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fitter-fit-interface">Fitter.fit() Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-mcmc-execution">Basic MCMC Execution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analyzing-results">Analyzing Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parameter-constraints">Parameter Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-predictions">Model Predictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualization">Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="redback_integration.html">Parameter Estimation with Redback</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_reference.html">Parameter Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation &amp; Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_api.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VegasAfterglow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MCMC Parameter Fitting</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mcmc_fitting.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mcmc-parameter-fitting">
<h1>MCMC Parameter Fitting<a class="headerlink" href="#mcmc-parameter-fitting" title="Link to this heading"></a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#mcmc-best-practices" id="id2">MCMC Best Practices</a></p>
<ul>
<li><p><a class="reference internal" href="#start-simple-add-complexity-gradually" id="id3">Start Simple, Add Complexity Gradually</a></p></li>
<li><p><a class="reference internal" href="#why-complex-models-are-problematic" id="id4">Why Complex Models Are Problematic</a></p></li>
<li><p><a class="reference internal" href="#when-to-use-complex-models" id="id5">When to Use Complex Models</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#basic-setup" id="id6">Basic Setup</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-observational-data" id="id7">Setting up Observational Data</a></p></li>
<li><p><a class="reference internal" href="#data-selection-and-optimization" id="id8">Data Selection and Optimization</a></p></li>
<li><p><a class="reference internal" href="#global-configuration" id="id9">Global Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#model-configurations" id="id10">Model Configurations</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-setup-default" id="id11">Basic Setup (Default)</a></p></li>
<li><p><a class="reference internal" href="#jet-structure-variations" id="id12">Jet Structure Variations</a></p></li>
<li><p><a class="reference internal" href="#medium-type-variations" id="id13">Medium Type Variations</a></p></li>
<li><p><a class="reference internal" href="#reverse-shock" id="id14">Reverse Shock</a></p></li>
<li><p><a class="reference internal" href="#inverse-compton-radiation" id="id15">Inverse Compton Radiation</a></p></li>
<li><p><a class="reference internal" href="#energy-injection" id="id16">Energy Injection</a></p></li>
<li><p><a class="reference internal" href="#complex-model-combinations" id="id17">Complex Model Combinations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-mcmc" id="id18">Running MCMC</a></p>
<ul>
<li><p><a class="reference internal" href="#choosing-a-sampler" id="id19">Choosing a Sampler</a></p></li>
<li><p><a class="reference internal" href="#fitter-fit-interface" id="id20">Fitter.fit() Interface</a></p></li>
<li><p><a class="reference internal" href="#basic-mcmc-execution" id="id21">Basic MCMC Execution</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#analyzing-results" id="id22">Analyzing Results</a></p>
<ul>
<li><p><a class="reference internal" href="#parameter-constraints" id="id23">Parameter Constraints</a></p></li>
<li><p><a class="reference internal" href="#model-predictions" id="id24">Model Predictions</a></p></li>
<li><p><a class="reference internal" href="#visualization" id="id25">Visualization</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#troubleshooting" id="id26">Troubleshooting</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MCMC fitting requires additional dependencies. Install them with:
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">VegasAfterglow[mcmc]</span></code></p>
</div>
<p>VegasAfterglow provides a comprehensive MCMC framework for parameter estimation of gamma-ray burst (GRB) afterglow models. The framework supports all built-in jet models, ambient medium configurations, radiation processes, and complex multi-wavelength datasets.</p>
<p>Key Features:</p>
<ul class="simple">
<li><p><strong>Bilby/Dynesty nested sampling</strong> for efficient parameter estimation</p></li>
<li><p><strong>All model types supported</strong>: TophatJet, GaussianJet, PowerLawJet, TwoComponentJet, StepPowerLawJet</p></li>
<li><p><strong>Complete physics</strong>: Forward shock, reverse shock, synchrotron, inverse Compton, magnetar injection</p></li>
<li><p><strong>Flexible data handling</strong>: Light curves and spectra with optional weighting</p></li>
</ul>
</section>
<section id="mcmc-best-practices">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">MCMC Best Practices</a><a class="headerlink" href="#mcmc-best-practices" title="Link to this heading"></a></h2>
<section id="start-simple-add-complexity-gradually">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Start Simple, Add Complexity Gradually</a><a class="headerlink" href="#start-simple-add-complexity-gradually" title="Link to this heading"></a></h3>
<p>The most common mistake in GRB afterglow fitting is starting with an overly complex model. <strong>Always begin with the simplest physically motivated model</strong> and only add complexity when the data clearly demands it.</p>
<p><strong>Recommended Progression:</strong></p>
<ol class="arabic">
<li><p><strong>Start with TopHat + ISM + Forward Shock Only</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>
<span class="c1"># All other physics options default to False</span>
</pre></div>
</div>
<p>This gives you ~7-8 free parameters. Run MCMC and examine the residuals.</p>
</li>
<li><p><strong>Check if residuals suggest additional physics</strong></p>
<p>Examine the fit quality and residual structure. Systematic deviations at specific times or frequencies may indicate missing physics.</p>
</li>
<li><p><strong>Add ONE component at a time</strong></p>
<p>Never jump from a simple model to enabling everything. Each addition should be justified by improved fit statistics (e.g., Bayesian evidence comparison).</p>
</li>
</ol>
</section>
<section id="why-complex-models-are-problematic">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Why Complex Models Are Problematic</a><a class="headerlink" href="#why-complex-models-are-problematic" title="Link to this heading"></a></h3>
<p><strong>1. Parameter Degeneracies</strong></p>
<p>More parameters create more degeneracies. For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">E_iso</span></code> and <code class="docutils literal notranslate"><span class="pre">n_ism</span></code> are degenerate in flux normalization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eps_e</span></code> and <code class="docutils literal notranslate"><span class="pre">eps_B</span></code> trade off in spectral shape</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta_c</span></code> and <code class="docutils literal notranslate"><span class="pre">theta_v</span></code> correlate for off-axis observers</p></li>
<li><p>Reverse shock parameters can mimic forward shock with different microphysics</p></li>
</ul>
<p>With a complex model, the MCMC may find multiple solutions that fit equally well but have very different physical interpretations.</p>
<p><strong>2. Computational Cost</strong></p>
<p>Each additional physics module increases computation time. A model with all physics enabled can be significantly slower than a basic forward-shock-only model.</p>
<p><strong>3. Overfitting Risk</strong></p>
<p>With enough free parameters, you can fit noise. A model that fits your data perfectly but has 15+ parameters may not be physically meaningful. Use Bayesian evidence (from dynesty) to compare models:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare two models using log evidence</span>
<span class="n">result_simple</span> <span class="o">=</span> <span class="n">fitter_simple</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">params_simple</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">result_complex</span> <span class="o">=</span> <span class="n">fitter_complex</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">params_complex</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1"># Bayes factor</span>
<span class="n">log_BF</span> <span class="o">=</span> <span class="n">result_complex</span><span class="o">.</span><span class="n">bilby_result</span><span class="o">.</span><span class="n">log_evidence</span> <span class="o">-</span> <span class="n">result_simple</span><span class="o">.</span><span class="n">bilby_result</span><span class="o">.</span><span class="n">log_evidence</span>

<span class="c1"># Interpretation:</span>
<span class="c1"># log_BF &lt; 1: No preference (stick with simple model)</span>
<span class="c1"># 1 &lt; log_BF &lt; 3: Weak preference for complex</span>
<span class="c1"># 3 &lt; log_BF &lt; 5: Moderate preference</span>
<span class="c1"># log_BF &gt; 5: Strong preference for complex model</span>
</pre></div>
</div>
<p><strong>4. Non-Physical Solutions</strong></p>
<p>Complex models can converge to non-physical parameter combinations. Always check:</p>
<ul class="simple">
<li><p>Is <code class="docutils literal notranslate"><span class="pre">eps_e</span> <span class="pre">+</span> <span class="pre">eps_B</span> <span class="pre">&lt;</span> <span class="pre">1</span></code>? (energy conservation)</p></li>
<li><p>Is <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">&gt;</span> <span class="pre">2</span></code>? (required for finite electron energy)</p></li>
<li><p>Are microphysics parameters consistent between forward/reverse shocks?</p></li>
<li><p>Does the inferred jet energy make sense given the host galaxy and redshift?</p></li>
</ul>
</section>
<section id="when-to-use-complex-models">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">When to Use Complex Models</a><a class="headerlink" href="#when-to-use-complex-models" title="Link to this heading"></a></h3>
<p>Complex models are justified when:</p>
<ul class="simple">
<li><p><strong>Clear observational signatures</strong> that simple models cannot explain after careful analysis</p></li>
<li><p><strong>Comparison with similar GRBs</strong> where the additional physics was robustly established</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Golden Rule</strong>: If you cannot clearly explain WHY each physics component is needed based on your data, you probably don’t need it.</p>
</div>
</section>
</section>
<section id="basic-setup">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Basic Setup</a><a class="headerlink" href="#basic-setup" title="Link to this heading"></a></h2>
<section id="setting-up-observational-data">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Setting up Observational Data</a><a class="headerlink" href="#setting-up-observational-data" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ObsData</span></code> class handles multi-wavelength observational data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ObsData</span><span class="p">,</span> <span class="n">Setups</span><span class="p">,</span> <span class="n">Fitter</span><span class="p">,</span> <span class="n">ParamDef</span><span class="p">,</span> <span class="n">Scale</span>

<span class="c1"># Create data container</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ObsData</span><span class="p">()</span>

<span class="c1"># Method 1: Add data directly</span>
<span class="n">t_data</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e3</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">,</span> <span class="mf">5e3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">]</span>  <span class="c1"># Time in seconds</span>
<span class="n">flux_data</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-26</span><span class="p">,</span> <span class="mf">8e-27</span><span class="p">,</span> <span class="mf">5e-27</span><span class="p">,</span> <span class="mf">3e-27</span><span class="p">,</span> <span class="mf">2e-27</span><span class="p">]</span>  <span class="c1"># erg/cm²/s/Hz</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-28</span><span class="p">,</span> <span class="mf">8e-28</span><span class="p">,</span> <span class="mf">5e-28</span><span class="p">,</span> <span class="mf">3e-28</span><span class="p">,</span> <span class="mf">2e-28</span><span class="p">]</span>   <span class="c1"># Error bars</span>

<span class="c1"># Add light curve at R-band frequency</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_flux_density</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="mf">4.84e14</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_data</span><span class="p">,</span>
                     <span class="n">f_nu</span><span class="o">=</span><span class="n">flux_data</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="n">flux_err</span><span class="p">)</span>  <span class="c1"># All quantities in CGS units</span>

<span class="c1"># Optional: Add weights for systematic uncertainties, normalization handled internally</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_data</span><span class="p">)</span>  <span class="c1"># Equal weights</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_flux_density</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="mf">2.4e17</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_data</span><span class="p">,</span>
                     <span class="n">f_nu</span><span class="o">=</span><span class="n">flux_data</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="n">flux_err</span><span class="p">,</span>
                     <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># All quantities in CGS units</span>

<span class="c1"># Method 2: Add frequency-integrated light curve (broadband flux)</span>
<span class="c1"># For instruments with wide frequency coverage (e.g., BAT, LAT, Fermi)</span>
<span class="n">nu_min</span> <span class="o">=</span> <span class="mf">1e17</span>  <span class="c1"># Lower frequency bound [Hz]</span>
<span class="n">nu_max</span> <span class="o">=</span> <span class="mf">1e19</span>  <span class="c1"># Upper frequency bound [Hz]</span>
<span class="n">num_points</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Number of frequency points for integration</span>

<span class="n">data</span><span class="o">.</span><span class="n">add_flux</span><span class="p">(</span><span class="n">nu_min</span><span class="o">=</span><span class="n">nu_min</span><span class="p">,</span> <span class="n">nu_max</span><span class="o">=</span><span class="n">nu_max</span><span class="p">,</span>
                     <span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_data</span><span class="p">,</span>
                     <span class="n">flux</span><span class="o">=</span><span class="n">flux_data</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="n">flux_err</span><span class="p">,</span>
                     <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>  <span class="c1"># All quantities in CGS units</span>

<span class="c1"># Method 3: Load from CSV files</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.4e17</span><span class="p">,</span> <span class="mf">4.84e14</span><span class="p">,</span> <span class="mf">1.4e14</span><span class="p">]</span>  <span class="c1"># X-ray, optical, near-IR</span>
<span class="n">lc_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;data/xray.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;data/optical.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;data/nir.csv&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">nu</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">lc_files</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">add_flux_density</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span>
                         <span class="n">f_nu</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_obs&quot;</span><span class="p">],</span> <span class="n">err</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_err&quot;</span><span class="p">])</span>  <span class="c1"># All quantities in CGS units</span>

<span class="c1"># Add spectra at specific times</span>
<span class="n">spec_times</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>  <span class="c1"># seconds</span>
<span class="n">spec_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;data/spec_1000s.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;data/spec_10000s.csv&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">spec_times</span><span class="p">,</span> <span class="n">spec_files</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">add_spectrum</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">],</span>
                      <span class="n">f_nu</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_obs&quot;</span><span class="p">],</span> <span class="n">err</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_err&quot;</span><span class="p">])</span>  <span class="c1"># All quantities in CGS units</span>
</pre></div>
</div>
</section>
<section id="data-selection-and-optimization">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Data Selection and Optimization</a><a class="headerlink" href="#data-selection-and-optimization" title="Link to this heading"></a></h3>
<p><strong>Smart Data Subsampling with logscale_screen</strong></p>
<p>For large datasets or densely sampled observations, using all available data points can lead to computational inefficiency and biased parameter estimation. The <code class="docutils literal notranslate"><span class="pre">logscale_screen</span></code> method provides intelligent data subsampling that maintains the essential information content while reducing computational overhead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Large dense dataset</span>
<span class="n">t_dense</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># 1000 time points</span>
<span class="n">flux_dense</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Dense flux measurements</span>
<span class="n">flux_err_dense</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">flux_dense</span>

<span class="c1"># Subsample using logarithmic screening</span>
<span class="c1"># This selects ~5*5=25 representative points across 5 decades in time</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">ObsData</span><span class="o">.</span><span class="n">logscale_screen</span><span class="p">(</span><span class="n">t_dense</span><span class="p">,</span> <span class="n">data_density</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Add only the selected subset</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_flux_density</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="mf">5e14</span><span class="p">,</span>
                     <span class="n">t</span><span class="o">=</span><span class="n">t_dense</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span>
                     <span class="n">f_nu</span><span class="o">=</span><span class="n">flux_dense</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span>
                     <span class="n">err</span><span class="o">=</span><span class="n">flux_err_dense</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
</pre></div>
</div>
<p><strong>Why logscale_screen is Important:</strong></p>
<ol class="arabic simple">
<li><p><strong>Prevents Oversampling Bias</strong>: Dense data clusters can dominate the χ² calculation, causing the MCMC to over-fit specific frequency bands or time periods.</p></li>
<li><p><strong>Computational Efficiency</strong>: Reduces the number of model evaluations needed during MCMC sampling, significantly improving performance.</p></li>
<li><p><strong>Preserves Information</strong>: Unlike uniform thinning, logarithmic sampling maintains representation across all temporal/spectral scales.</p></li>
<li><p><strong>Balanced Multi-band Fitting</strong>: Ensures each frequency band contributes proportionally to the parameter constraints.</p></li>
</ol>
<p><strong>Data Selection Guidelines:</strong></p>
<ul class="simple">
<li><p><strong>Target 10-30 points per frequency band</strong> for balanced constraints</p></li>
<li><p><strong>Avoid &gt;100 points in any single band</strong> unless scientifically justified</p></li>
<li><p><strong>Maintain temporal coverage</strong> across all evolutionary phases</p></li>
<li><p><strong>Weight systematic uncertainties</strong> appropriately using the weights parameter</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Common Data Selection Pitfalls:</strong></p>
<ul class="simple">
<li><p><strong>Optical-heavy datasets</strong>: Dense optical coverage can bias parameters toward optical-dominant solutions</p></li>
<li><p><strong>Late-time clustering</strong>: Too many late-time points can over-constrain decay slopes at the expense of early physics</p></li>
<li><p><strong>Single-epoch spectra</strong>: Broadband spectra at one time can dominate multi-epoch light curves in χ² space</p></li>
</ul>
<p><strong>Solution</strong>: Use <code class="docutils literal notranslate"><span class="pre">logscale_screen</span></code> for manual temporal reduction of over-sampled bands.</p>
</div>
<p><strong>Handling Measurement Uncertainties</strong></p>
<p>Error bars strongly influence MCMC fitting. Improperly characterized uncertainties can lead to biased parameter estimates or misleading confidence intervals.</p>
<p><strong>The Problem with Small Error Bars</strong></p>
<p>Data points with very small uncertainties dominate the χ² calculation:</p>
<div class="math notranslate nohighlight">
\[\chi^2 = \sum_i \frac{(F_{\rm obs,i} - F_{\rm model,i})^2}{\sigma_i^2}\]</div>
<p>A single point with σ = 0.01 mJy contributes 100× more to χ² than a point with σ = 0.1 mJy. This causes the MCMC to:</p>
<ul class="simple">
<li><p>Heavily weight high-precision data at the expense of other observations</p></li>
<li><p>Potentially fit noise or systematic effects in the “precise” data</p></li>
<li><p>Produce artificially tight parameter constraints that don’t reflect true uncertainties</p></li>
</ul>
<p><strong>Common Scenarios:</strong></p>
<ol class="arabic simple">
<li><p><strong>Heterogeneous data quality</strong>: X-ray data from different telescopes may have vastly different calibration uncertainties</p></li>
<li><p><strong>Underestimated errors</strong>: Published error bars sometimes only include statistical uncertainty, missing systematics</p></li>
<li><p><strong>Calibration offsets</strong>: Different instruments may have 5-20% flux calibration offsets not captured in quoted errors</p></li>
</ol>
<p><strong>Solutions:</strong></p>
<ol class="arabic">
<li><p><strong>Add systematic error floors</strong></p>
<p>For data where quoted errors seem unrealistically small:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add 10% systematic floor to error bars</span>
<span class="n">systematic_floor</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># 10% of flux</span>
<span class="n">err_with_floor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">systematic_floor</span> <span class="o">*</span> <span class="n">flux</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">add_flux_density</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">f_nu</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="n">err_with_floor</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Use weights to balance bands</strong></p>
<p>Down-weight bands with suspiciously small errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reduce contribution of high-precision optical data</span>
<span class="n">optical_weight</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Effectively doubles the error contribution</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_flux_density</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="mf">5e14</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t_optical</span><span class="p">,</span> <span class="n">f_nu</span><span class="o">=</span><span class="n">flux_optical</span><span class="p">,</span>
                     <span class="n">err</span><span class="o">=</span><span class="n">err_optical</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">optical_weight</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">t_optical</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p><strong>Inspect residuals by band</strong></p>
<p>After fitting, check if residuals are consistent across bands. If one band shows systematic deviations while others don’t, the errors for that band may be mischaracterized.</p>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Rule of thumb</strong>: If your best-fit χ²/dof &gt;&gt; 1, either the model is inadequate OR the error bars are underestimated. If χ²/dof &lt;&lt; 1, the errors may be overestimated.</p>
</div>
</section>
<section id="global-configuration">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Global Configuration</a><a class="headerlink" href="#global-configuration" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Setups</span></code> class defines fixed model properties:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>

<span class="c1"># Source properties</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">lumi_dist</span> <span class="o">=</span> <span class="mf">3.364e28</span>  <span class="c1"># Luminosity distance [cm]</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">1.58</span>              <span class="c1"># Redshift</span>

<span class="c1"># Model selection (see sections below for all options)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>       <span class="c1"># Ambient medium type</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;powerlaw&quot;</span>      <span class="c1"># Jet structure type</span>

<span class="c1"># Physics options</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_shock</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1"># Include reverse shock</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">fwd_ssc</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Forward shock inverse Compton</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_ssc</span> <span class="o">=</span> <span class="kc">False</span>       <span class="c1"># Reverse shock inverse Compton</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">ssc_cooling</span> <span class="o">=</span> <span class="kc">True</span>     <span class="c1"># IC cooling effects</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">kn</span> <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># Klein-Nishina corrections</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">magnetar</span> <span class="o">=</span> <span class="kc">True</span>       <span class="c1"># Magnetar energy injection</span>

<span class="c1"># Numerical parameters</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-5</span>           <span class="c1"># Numerical tolerance</span>
</pre></div>
</div>
</section>
</section>
<section id="model-configurations">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Model Configurations</a><a class="headerlink" href="#model-configurations" title="Link to this heading"></a></h2>
<section id="basic-setup-default">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Basic Setup (Default)</a><a class="headerlink" href="#basic-setup-default" title="Link to this heading"></a></h3>
<p>The default configuration uses a top-hat jet in a uniform ISM environment with forward shock synchrotron emission:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic configuration</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>        <span class="c1"># Uniform ISM density</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>        <span class="c1"># Top-hat jet structure</span>

<span class="c1"># Basic parameter set</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Isotropic energy in erg</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Lorentz factor</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Opening angle in radians</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>   <span class="c1"># Viewing angle (on-axis) in radians</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Number density in cm^-3</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Electron spectral index</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Electron energy fraction</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Magnetic energy fraction</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Fraction of accelerated electrons</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="jet-structure-variations">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Jet Structure Variations</a><a class="headerlink" href="#jet-structure-variations" title="Link to this heading"></a></h3>
<p><strong>Power-law Structured Jet</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>        <span class="c1"># Default ISM medium</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;powerlaw&quot;</span>      <span class="c1"># Power-law structured jet</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Basic jet parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.3</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Allow off-axis viewing</span>

    <span class="c1"># Power-law structure parameters</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;k_e&quot;</span><span class="p">,</span>      <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Energy power-law index, default 2.0 if not specified</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;k_g&quot;</span><span class="p">,</span>      <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Lorentz factor power-law, default 2.0 if not specified</span>

    <span class="c1"># Medium and microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Gaussian Structured Jet</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>      <span class="c1"># Gaussian structured jet</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Basic parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span>   <span class="mf">0.2</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Gaussian width parameter</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Two-Component Jet</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;two_component&quot;</span>  <span class="c1"># Two-component jet</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Narrow component</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e53</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Core energy</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Core Lorentz factor</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Core angle</span>

    <span class="c1"># Wide component</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso_w&quot;</span><span class="p">,</span> <span class="mf">1e49</span><span class="p">,</span>  <span class="mf">1e52</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wide energy in erg</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0_w&quot;</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wide Lorentz factor</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_w&quot;</span><span class="p">,</span>  <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Wide angle in radians</span>

    <span class="c1"># Observation and medium (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.3</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Step Power-law Jet</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;step_powerlaw&quot;</span>  <span class="c1"># Step power-law jet</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Core component (uniform)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e51</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Core energy</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">50</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Core Lorentz factor</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Core boundary</span>

    <span class="c1"># Wing component (power-law)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso_w&quot;</span><span class="p">,</span> <span class="mf">1e49</span><span class="p">,</span>  <span class="mf">1e52</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wing energy scale</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0_w&quot;</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wing Lorentz factor</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;k_e&quot;</span><span class="p">,</span>      <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Energy power-law</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;k_g&quot;</span><span class="p">,</span>      <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Lorentz factor power-law</span>

    <span class="c1"># Standard parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.3</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="medium-type-variations">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Medium Type Variations</a><a class="headerlink" href="#medium-type-variations" title="Link to this heading"></a></h3>
<p><strong>Stellar Wind Medium</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>       <span class="c1"># Stellar wind medium</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>        <span class="c1"># Default jet structure</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard jet parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>

    <span class="c1"># Wind medium parameter (replaces n_ism)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;A_star&quot;</span><span class="p">,</span>  <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wind parameter</span>

    <span class="c1"># Standard microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Stratified Medium: ISM-to-Wind</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>       <span class="c1"># Use wind for stratified models</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>        <span class="c1"># Default jet structure</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard jet parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>

    <span class="c1"># Stratified medium parameters</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;A_star&quot;</span><span class="p">,</span>  <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wind strength (outer)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">,</span>      <span class="mf">1e-3</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># ISM density (inner) in cm^-3</span>

    <span class="c1"># Standard microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Stratified Medium: Wind-to-ISM</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard jet parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>

    <span class="c1"># Stratified medium (wind → ISM)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;A_star&quot;</span><span class="p">,</span>  <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Inner wind strength</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Outer ISM density</span>

    <span class="c1"># Standard microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Stratified Medium: ISM-Wind-ISM</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard jet parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>

    <span class="c1"># Three-zone stratified medium</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;A_star&quot;</span><span class="p">,</span>  <span class="mf">1e-4</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Wind parameter (middle)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Outer ISM density</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">,</span>      <span class="mf">1e-2</span><span class="p">,</span>    <span class="mi">20</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Inner ISM density</span>

    <span class="c1"># Standard microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Stratified Medium Physics:</strong></p>
<ul class="simple">
<li><p><strong>A_star = 0</strong>: Pure ISM with density n_ism</p></li>
<li><p><strong>n0 = ∞</strong>: Pure wind profile from center</p></li>
<li><p><strong>A_star &gt; 0, n0 &lt; ∞</strong>: ISM-wind-ISM stratification</p></li>
<li><p><strong>A_star &gt; 0, n0 = ∞</strong>: Wind-ISM stratification</p></li>
</ul>
<p><strong>Density Profile:</strong> Inner (r &lt; r₁): n = n0, Middle (r₁ &lt; r &lt; r₂): n ∝ A_star/r², Outer (r &gt; r₂): n = n_ism</p>
</div>
</section>
<section id="reverse-shock">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Reverse Shock</a><a class="headerlink" href="#reverse-shock" title="Link to this heading"></a></h3>
<p><strong>Basic Reverse Shock</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>        <span class="c1"># Default medium</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>        <span class="c1"># Default jet</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_shock</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1"># Enable reverse shock</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard jet and medium parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Jet duration (important for reverse shock)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>   <span class="mf">1e6</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Jet duration in seconds</span>

    <span class="c1"># Forward shock microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>

    <span class="c1"># Reverse shock microphysics (can be different)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p_r&quot;</span><span class="p">,</span>      <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e_r&quot;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B_r&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e_r&quot;</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Reverse Shock with Structured Jet</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>      <span class="c1"># Structured jet example</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_shock</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Gaussian jet parameters</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">50</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span>   <span class="mf">0.2</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>   <span class="mf">1e6</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Forward + reverse shock microphysics</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p_r&quot;</span><span class="p">,</span>      <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e_r&quot;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B_r&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e_r&quot;</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="inverse-compton-radiation">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Inverse Compton Radiation</a><a class="headerlink" href="#inverse-compton-radiation" title="Link to this heading"></a></h3>
<p><strong>Forward Shock Inverse Compton</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>        <span class="c1"># Default medium</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>        <span class="c1"># Default jet</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">fwd_ssc</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Forward shock SSC</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">ssc_cooling</span> <span class="o">=</span> <span class="kc">True</span>     <span class="c1"># IC cooling effects</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">kn</span> <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># Klein-Nishina corrections</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Reverse Shock Inverse Compton</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_shock</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1"># Enable reverse shock</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">fwd_ssc</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Forward shock SSC</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_ssc</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Reverse shock SSC</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">ssc_cooling</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">kn</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard parameters with reverse shock</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Forward + reverse microphysics</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p_r&quot;</span><span class="p">,</span>      <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e_r&quot;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B_r&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e_r&quot;</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="energy-injection">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Energy Injection</a><a class="headerlink" href="#energy-injection" title="Link to this heading"></a></h3>
<p><strong>Magnetar Spin-down Injection</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>        <span class="c1"># Default medium</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;tophat&quot;</span>        <span class="c1"># Default jet</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">magnetar</span> <span class="o">=</span> <span class="kc">True</span>       <span class="c1"># Enable magnetar injection</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Standard jet and medium parameters (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Magnetar injection parameters</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span>      <span class="mf">1e42</span><span class="p">,</span>  <span class="mf">1e48</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Initial luminosity [erg/s]</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;t0&quot;</span><span class="p">,</span>        <span class="mi">10</span><span class="p">,</span>  <span class="mi">1000</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>     <span class="c1"># Spin-down timescale [s]</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span>        <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>  <span class="c1"># Power-law index</span>

    <span class="c1"># Standard microphysics (same as default)</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Magnetar Injection Profile:</strong> L(t) = L0 × (1 + t/t0)^(-q) for θ &lt; θc</p>
</div>
<p><strong>Magnetar with Structured Jet</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;ism&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;powerlaw&quot;</span>      <span class="c1"># Structured jet</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">magnetar</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Power-law jet with magnetar</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>   <span class="mf">0.3</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;k_e&quot;</span><span class="p">,</span>      <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;k_g&quot;</span><span class="p">,</span>      <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Magnetar parameters</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span>      <span class="mf">1e42</span><span class="p">,</span>  <span class="mf">1e48</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;t0&quot;</span><span class="p">,</span>        <span class="mi">10</span><span class="p">,</span>  <span class="mi">1000</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span>        <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>

    <span class="c1"># Standard microphysics</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="complex-model-combinations">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Complex Model Combinations</a><a class="headerlink" href="#complex-model-combinations" title="Link to this heading"></a></h3>
<p><strong>Full Physics: Structured Jet + Stratified Medium + Reverse Shock + IC + Magnetar</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>       <span class="c1"># Stratified medium</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>      <span class="c1"># Structured jet</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_shock</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1"># Reverse shock</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">fwd_ssc</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Forward SSC</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">rvs_ssc</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># Reverse SSC</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">ssc_cooling</span> <span class="o">=</span> <span class="kc">True</span>    <span class="c1"># IC cooling</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">kn</span> <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># Klein-Nishina</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">magnetar</span> <span class="o">=</span> <span class="kc">True</span>       <span class="c1"># Magnetar energy injection</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Gaussian jet</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>    <span class="mi">50</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span>   <span class="mf">0.2</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Stratified medium</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;A_star&quot;</span><span class="p">,</span>  <span class="mf">1e-4</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n_ism&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">,</span>      <span class="mf">1e-2</span><span class="p">,</span>    <span class="mi">50</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>

    <span class="c1"># Magnetar injection</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span>      <span class="mf">1e42</span><span class="p">,</span>  <span class="mf">1e48</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;t0&quot;</span><span class="p">,</span>        <span class="mi">10</span><span class="p">,</span>  <span class="mi">1000</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span>        <span class="mf">1.5</span><span class="p">,</span>   <span class="mf">3.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>

    <span class="c1"># Forward shock microphysics</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>        <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>     <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>

    <span class="c1"># Reverse shock microphysics</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p_r&quot;</span><span class="p">,</span>      <span class="mf">2.1</span><span class="p">,</span>   <span class="mf">2.8</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e_r&quot;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B_r&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e_r&quot;</span><span class="p">,</span>   <span class="mf">0.1</span><span class="p">,</span>   <span class="mf">1.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Complex Model Considerations:</strong>
- Use coarser resolution initially: <code class="docutils literal notranslate"><span class="pre">resolution=(0.2,</span> <span class="pre">0.7,</span> <span class="pre">7)</span></code>
- Increase live points: <code class="docutils literal notranslate"><span class="pre">nlive=1000+</span></code>
- Lower dlogz for better convergence: <code class="docutils literal notranslate"><span class="pre">dlogz=0.05</span></code>
- Consider parameter degeneracies in interpretation</p>
</div>
</section>
</section>
<section id="running-mcmc">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Running MCMC</a><a class="headerlink" href="#running-mcmc" title="Link to this heading"></a></h2>
<section id="choosing-a-sampler">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Choosing a Sampler</a><a class="headerlink" href="#choosing-a-sampler" title="Link to this heading"></a></h3>
<p>The choice of sampler significantly affects both the quality of results and computational efficiency. Here’s guidance on when to use each:</p>
<p><strong>Emcee (Ensemble MCMC) - Recommended for Most Cases</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;emcee&quot;</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">nburn</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Use emcee when:</p>
<ul class="simple">
<li><p>You need <strong>fast exploration</strong> of parameter space</p></li>
<li><p>The posterior is expected to be <strong>unimodal</strong> (single peak)</p></li>
<li><p>You’re doing <strong>quick preliminary fits</strong> or production runs</p></li>
</ul>
<p>VegasAfterglow uses an optimized emcee configuration:</p>
<ul class="simple">
<li><p><strong>Custom proposal moves</strong>: DEMove (70%) + DESnookerMove (30%) for better mixing than default stretch move</p></li>
<li><p><strong>Vectorized batch processing</strong>: Likelihood evaluations are parallelized via OpenMP internally</p></li>
<li><p><strong>Automatic nwalkers</strong>: Optimized based on parameter count and CPU cores</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Parallelization is automatic</strong>: For emcee, the <code class="docutils literal notranslate"><span class="pre">npool</span></code> parameter is ignored. The C++ backend uses OpenMP multi-threading for batch likelihood evaluation, which is faster than Python multiprocessing.</p>
</div>
<p><strong>Dynesty (Nested Sampling) - For Model Comparison</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span> <span class="n">nlive</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">dlogz</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Use dynesty when:</p>
<ul class="simple">
<li><p>You need <strong>Bayesian evidence</strong> for model comparison</p></li>
<li><p>The posterior may be <strong>multimodal</strong> (multiple peaks)</p></li>
<li><p>You want to compare different physics configurations</p></li>
</ul>
<p>VegasAfterglow uses optimized dynesty settings:</p>
<ul class="simple">
<li><p><strong>rslice sampling</strong>: More efficient than random walk for high dimensions</p></li>
<li><p><strong>Thread pool</strong>: Uses Python threading (not multiprocessing) for better performance with C++ backend</p></li>
<li><p><strong>Optimal queue size</strong>: Automatically calculated based on nlive and npool</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For dynesty, <code class="docutils literal notranslate"><span class="pre">npool</span></code> controls the number of parallel threads. If not specified, it defaults to the number of CPU cores on your machine.</p>
</div>
<p><strong>Recommended Workflow</strong></p>
<ol class="arabic simple">
<li><p><strong>Quick exploration</strong>: Use emcee with moderate steps (5000-10000) to find approximate parameter region</p></li>
<li><p><strong>Model comparison</strong>: Use dynesty when comparing different physics (forward shock only vs. with reverse shock, etc.)</p></li>
<li><p><strong>Production run</strong>: Use emcee with longer chains (20000-50000 steps) for final parameter constraints</p></li>
</ol>
</section>
<section id="fitter-fit-interface">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Fitter.fit() Interface</a><a class="headerlink" href="#fitter-fit-interface" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Fitter.fit()</span></code> method provides a unified interface for parameter estimation using different sampling algorithms via bilby.</p>
<p><strong>Method Signature</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">param_defs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ParamDef</span><span class="p">],</span>      <span class="c1"># Parameter definitions</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>  <span class="c1"># Grid resolution</span>
    <span class="n">sampler</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dynesty&quot;</span><span class="p">,</span>             <span class="c1"># Sampler algorithm</span>
    <span class="n">npool</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>                      <span class="c1"># Number of parallel processes</span>
    <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>                     <span class="c1"># Number of best fits to return</span>
    <span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bilby_output&quot;</span><span class="p">,</span>        <span class="c1"># Output directory</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;afterglow&quot;</span><span class="p">,</span>            <span class="c1"># Run label</span>
    <span class="n">clean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                  <span class="c1"># Clean up intermediate files</span>
    <span class="n">resume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                <span class="c1"># Resume previous run</span>
    <span class="o">**</span><span class="n">sampler_kwargs</span>                     <span class="c1"># Sampler-specific parameters</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FitResult</span>
</pre></div>
</div>
<p><strong>Common Parameters</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">param_defs</span></code>: List of <code class="docutils literal notranslate"><span class="pre">ParamDef</span></code> objects defining parameters to fit</dt><dd><ul>
<li><p>Required parameter for all samplers</p></li>
<li><p>See “Parameter Definition” section for details</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">resolution</span></code>: Tuple of (phi_res, theta_res, t_res)</dt><dd><ul>
<li><p>Controls model computation grid spacing</p></li>
<li><p>Lower values = lower accuracy but faster computation</p></li>
<li><p>Default: (0.15, 0.5, 10) provides good balance</p></li>
<li><p>Example: (0.1, 1, 15) for higher accuracy</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sampler</span></code>: Sampling algorithm to use</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;emcee&quot;</span></code>: Affine-invariant MCMC ensemble sampler (recommended for speed)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;dynesty&quot;</span></code>: Dynamic nested sampling (for Bayesian evidence)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;nestle&quot;</span></code>: Alternative nested sampling implementation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;cpnest&quot;</span></code>: Nested sampling with parallel tempering</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;pymultinest&quot;</span></code>: MultiNest nested sampling algorithm</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ultranest&quot;</span></code>: Nested sampling with slice sampling</p></li>
<li><p>Other samplers supported by bilby - see <a class="reference external" href="https://lscsoft.docs.ligo.org/bilby/samplers.html">bilby documentation</a> for details</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">npool</span></code>: Number of parallel worker processes</dt><dd><ul>
<li><p>Set to number of CPU cores for best performance</p></li>
<li><p>Default: 1 (no parallelization)</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">npool=8</span></code> on an 8-core machine</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">top_k</span></code>: Number of best-fit parameter sets to extract</dt><dd><ul>
<li><p>Useful for exploring multiple local maxima</p></li>
<li><p>Default: 10</p></li>
<li><p>Results sorted by log probability (highest first)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">outdir</span></code>: Directory for output files</dt><dd><ul>
<li><p>Default: <code class="docutils literal notranslate"><span class="pre">&quot;bilby_output&quot;</span></code></p></li>
<li><p>Contains checkpoint files, result files, and plots</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">label</span></code>: Run identifier</dt><dd><ul>
<li><p>Default: <code class="docutils literal notranslate"><span class="pre">&quot;afterglow&quot;</span></code></p></li>
<li><p>Used in output filenames: <code class="docutils literal notranslate"><span class="pre">{label}_result.json</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code>: Whether to remove intermediate files</dt><dd><ul>
<li><p>Default: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">False</span></code> to keep checkpoint files for inspection</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">resume</span></code>: Resume from previous run</dt><dd><ul>
<li><p>Default: <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p>Requires matching <code class="docutils literal notranslate"><span class="pre">outdir</span></code> and <code class="docutils literal notranslate"><span class="pre">label</span></code> from previous run</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Emcee-Specific Parameters</strong> (<code class="docutils literal notranslate"><span class="pre">sampler=&quot;emcee&quot;</span></code>)</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">nsteps</span></code>: Number of MCMC steps per walker</dt><dd><ul>
<li><p>Default: 5000</p></li>
<li><p>More steps = better convergence but longer runtime</p></li>
<li><p>Typical range: 5000-50000</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">nburn</span></code>: Number of burn-in steps to discard</dt><dd><ul>
<li><p>Default: 1000</p></li>
<li><p>Should be long enough to reach equilibrium</p></li>
<li><p>Rule of thumb: 10-20% of <code class="docutils literal notranslate"><span class="pre">nsteps</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">thin</span></code>: Thinning factor (save every nth sample)</dt><dd><ul>
<li><p>Default: 1 (save all samples)</p></li>
<li><p>Use to reduce autocorrelation in chain</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">thin=10</span></code> saves every 10th step</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">nwalkers</span></code>: Number of ensemble walkers</dt><dd><ul>
<li><p>Default: <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">n_params</span></code> (automatically set)</p></li>
<li><p>More walkers = better exploration but more computation</p></li>
<li><p>Minimum: <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">n_params</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Dynesty-Specific Parameters</strong> (<code class="docutils literal notranslate"><span class="pre">sampler=&quot;dynesty&quot;</span></code>)</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">nlive</span></code>: Number of live points</dt><dd><ul>
<li><p>Default: 500 (recommended: 1000 for production runs)</p></li>
<li><p>More points = better evidence estimate but slower</p></li>
<li><p>Typical range: 500-2000</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">dlogz</span></code>: Evidence tolerance (stopping criterion)</dt><dd><ul>
<li><p>Default: 0.1 (recommended: 0.5 for faster convergence)</p></li>
<li><p>Smaller values = more thorough sampling</p></li>
<li><p>Typical range: 0.01-0.5</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">sample</span></code>: Sampling method</dt><dd><ul>
<li><p>Default: <code class="docutils literal notranslate"><span class="pre">&quot;rwalk&quot;</span></code> (random walk)</p></li>
<li><p>Other options: <code class="docutils literal notranslate"><span class="pre">&quot;slice&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;rslice&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;unif&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;rwalk&quot;</span></code> works well for most problems</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">walks</span></code>: Number of random walk steps</dt><dd><ul>
<li><p>Default: 100</p></li>
<li><p>Only relevant for <code class="docutils literal notranslate"><span class="pre">sample=&quot;rwalk&quot;</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">maxmcmc</span></code>: Maximum MCMC steps for slice sampling</dt><dd><ul>
<li><p>Default: 5000</p></li>
<li><p>Only relevant for slice samplers</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Other Samplers</strong></p>
<p>VegasAfterglow supports all samplers available in bilby, including:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;nestle&quot;</span></code>: Nested sampling (similar to dynesty)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;cpnest&quot;</span></code>: Nested sampling with parallel tempering</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;pymultinest&quot;</span></code>: MultiNest algorithm (requires separate installation)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ultranest&quot;</span></code>: Advanced nested sampling with slice sampling</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ptemcee&quot;</span></code>: Parallel-tempered MCMC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;kombine&quot;</span></code>: Clustered KDE proposal MCMC</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;pypolychord&quot;</span></code>: PolyChord nested sampling</p></li>
</ul>
<p>For sampler-specific parameters, refer to the <a class="reference external" href="https://bilby-dev.github.io/bilby/">bilby sampler documentation</a>.
Pass sampler-specific parameters via <code class="docutils literal notranslate"><span class="pre">**sampler_kwargs</span></code> in the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method.</p>
<p><strong>Example with alternative sampler:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using nestle sampler</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;nestle&quot;</span><span class="p">,</span>
    <span class="n">nlive</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>           <span class="c1"># nestle-specific parameter</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span>       <span class="c1"># nestle-specific: &#39;classic&#39;, &#39;single&#39;, or &#39;multi&#39;</span>
    <span class="n">npool</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Return Value: FitResult</strong></p>
<p>The method returns a <code class="docutils literal notranslate"><span class="pre">FitResult</span></code> object with the following attributes:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">samples</span></code>: Posterior samples array</dt><dd><ul>
<li><p>Shape: <code class="docutils literal notranslate"><span class="pre">[n_samples,</span> <span class="pre">1,</span> <span class="pre">n_params]</span></code></p></li>
<li><p>In transformed space (log10 for LOG-scale parameters)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">labels</span></code>: Parameter names as used in sampling</dt><dd><ul>
<li><p>LOG-scale parameters have <code class="docutils literal notranslate"><span class="pre">log10_</span></code> prefix</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">[&quot;log10_E_iso&quot;,</span> <span class="pre">&quot;log10_Gamma0&quot;,</span> <span class="pre">&quot;theta_c&quot;,</span> <span class="pre">&quot;p&quot;,</span> <span class="pre">...]</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">latex_labels</span></code>: LaTeX-formatted labels for plotting</dt><dd><ul>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">[&quot;$\\log_{10}(E_{\\rm</span> <span class="pre">iso})$&quot;,</span> <span class="pre">&quot;$\\log_{10}(\\Gamma_0)$&quot;,</span> <span class="pre">&quot;$\\theta_c$&quot;,</span> <span class="pre">...]</span></code></p></li>
<li><p>Use these for corner plots and visualizations</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">top_k_params</span></code>: Best-fit parameter values</dt><dd><ul>
<li><p>Shape: <code class="docutils literal notranslate"><span class="pre">[top_k,</span> <span class="pre">n_params]</span></code></p></li>
<li><p>Sorted by log probability (highest first)</p></li>
<li><p>In transformed space (log10 for LOG-scale parameters)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">top_k_log_probs</span></code>: Log probabilities for top-k fits</dt><dd><ul>
<li><p>Shape: <code class="docutils literal notranslate"><span class="pre">[top_k]</span></code></p></li>
<li><p>Can convert to χ² via: <code class="docutils literal notranslate"><span class="pre">chi2</span> <span class="pre">=</span> <span class="pre">-2</span> <span class="pre">*</span> <span class="pre">log_prob</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">log_probs</span></code>: Log probabilities for all samples</dt><dd><ul>
<li><p>Shape: <code class="docutils literal notranslate"><span class="pre">[n_samples,</span> <span class="pre">1]</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">bilby_result</span></code>: Full bilby Result object</dt><dd><ul>
<li><p>Contains additional diagnostics and metadata</p></li>
<li><p>Use for advanced analysis and plotting</p></li>
<li><p>Access via: <code class="docutils literal notranslate"><span class="pre">result.bilby_result.plot_corner()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="basic-mcmc-execution">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Basic MCMC Execution</a><a class="headerlink" href="#basic-mcmc-execution" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check data statistics before MCMC</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total data points: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">data_points_num</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create fitter object</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">Fitter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>

<span class="c1"># Option 1 (Recommended): Nested sampling with dynesty (computes Bayesian evidence, robust for multimodal posteriors)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>     <span class="c1"># Grid resolution (phi, theta, t)</span>
    <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;dynesty&quot;</span><span class="p">,</span>             <span class="c1"># Nested sampling algorithm</span>
    <span class="n">nlive</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>                    <span class="c1"># Number of live points</span>
    <span class="n">walks</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>                     <span class="c1"># Number of random walks per live point</span>
    <span class="n">dlogz</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>                     <span class="c1"># Stopping criterion (evidence tolerance)</span>
    <span class="n">npool</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>                       <span class="c1"># Number of parallel processes</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>                      <span class="c1"># Number of best-fit parameters to return</span>
<span class="p">)</span>

<span class="c1"># Option 2: MCMC with emcee (faster, good for unimodal posteriors, hard to converge for multimodal posteriors)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">params</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>     <span class="c1"># Grid resolution (phi, theta, t)</span>
    <span class="n">sampler</span><span class="o">=</span><span class="s2">&quot;emcee&quot;</span><span class="p">,</span>               <span class="c1"># MCMC sampler</span>
    <span class="n">nsteps</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>                  <span class="c1"># Number of steps per walker</span>
    <span class="n">nburn</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>                   <span class="c1"># Burn-in steps to discard</span>
    <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>                        <span class="c1"># Save every nth sample</span>
    <span class="n">npool</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>                       <span class="c1"># Number of parallel processes</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>                      <span class="c1"># Number of best-fit parameters to return</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt><strong>Important Notes:</strong></dt><dd><ul class="simple">
<li><p>Parameters with <code class="docutils literal notranslate"><span class="pre">Scale.LOG</span></code> are sampled as <code class="docutils literal notranslate"><span class="pre">log10_&lt;name&gt;</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">log10_E_iso</span></code>)</p></li>
<li><p>The sampler works in log10 space for LOG-scale parameters, then transforms back to physical values</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">npool</span></code> to parallelize likelihood evaluations across multiple CPU cores</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result.latex_labels</span></code> provides properly formatted labels for corner plots</p></li>
<li><p>For emcee, total samples = <code class="docutils literal notranslate"><span class="pre">nwalkers</span> <span class="pre">*</span> <span class="pre">(nsteps</span> <span class="pre">-</span> <span class="pre">nburn)</span> <span class="pre">/</span> <span class="pre">thin</span></code></p></li>
<li><p>For dynesty, sample count depends on convergence (not fixed)</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="analyzing-results">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">Analyzing Results</a><a class="headerlink" href="#analyzing-results" title="Link to this heading"></a></h2>
<section id="parameter-constraints">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Parameter Constraints</a><a class="headerlink" href="#parameter-constraints" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print best-fit parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Top-k parameters:&quot;</span><span class="p">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Rank&#39;</span><span class="si">:</span><span class="s2">&gt;4s</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;chi^2&#39;</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&gt;10s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">top_k_params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">result</span><span class="o">.</span><span class="n">top_k_log_probs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">10.4f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">top_k_params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">4d</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">chi2</span><span class="si">:</span><span class="s2">10.2f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">vals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="model-predictions">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Model Predictions</a><a class="headerlink" href="#model-predictions" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate model predictions with best-fit parameters</span>
<span class="n">t_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">nu_model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e9</span><span class="p">,</span> <span class="mf">5e14</span><span class="p">,</span> <span class="mf">2e17</span><span class="p">])</span>  <span class="c1"># Radio, optical, X-ray</span>

<span class="c1"># Light curves at specific frequencies</span>
<span class="n">lc_model</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">flux_density_grid</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">top_k_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_model</span><span class="p">,</span> <span class="n">nu_model</span><span class="p">)</span>

<span class="c1"># Spectra at specific times</span>
<span class="n">nu_spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">times_spec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
<span class="n">spec_model</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">flux_density_grid</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">top_k_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times_spec</span><span class="p">,</span> <span class="n">nu_spec</span><span class="p">)</span>

<span class="c1"># Frequency-integrated flux (broadband light curves)</span>
<span class="c1"># Useful for comparing with instruments like Swift/BAT, Fermi/LAT</span>
<span class="n">nu_min_broad</span> <span class="o">=</span> <span class="mf">1e17</span>  <span class="c1"># Lower frequency bound [Hz]</span>
<span class="n">nu_max_broad</span> <span class="o">=</span> <span class="mf">1e19</span>  <span class="c1"># Upper frequency bound [Hz]</span>
<span class="n">num_freq_points</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Number of frequency points for integration</span>

<span class="n">flux_integrated</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">flux</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">top_k_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_model</span><span class="p">,</span>
                              <span class="n">nu_min_broad</span><span class="p">,</span> <span class="n">nu_max_broad</span><span class="p">,</span> <span class="n">num_freq_points</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="visualization">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Visualization</a><a class="headerlink" href="#visualization" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">corner</span>

<span class="n">flat_chain</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Corner plot for parameter correlations</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
    <span class="n">flat_chain</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">latex_labels</span><span class="p">,</span>
    <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>
    <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;corner_plot.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1"># Light curve comparison</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nu_model</span><span class="p">,</span> <span class="n">colors</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Plot data (if available)</span>
    <span class="c1"># ax.errorbar(t_data, flux_data, flux_err, fmt=&#39;o&#39;, color=color)</span>

    <span class="c1"># Plot model</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">t_model</span><span class="p">,</span> <span class="n">lc_model</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [s]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux Density [erg/cm²/s/Hz]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ν = </span><span class="si">{</span><span class="n">nu</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;lightcurve_fit.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2><a class="toc-backref" href="#id26" role="doc-backlink">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<p>For comprehensive troubleshooting help including MCMC convergence issues, data selection problems, memory optimization, and performance tuning, see <a class="reference internal" href="troubleshooting.html"><span class="doc">Troubleshooting</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="redback_integration.html" class="btn btn-neutral float-right" title="Parameter Estimation with Redback" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, VegasAfterglow Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>