

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quickstart &mdash; VegasAfterglow 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=20074c1a" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c0df17a3" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=c0df17a3" />

  
    <link rel="shortcut icon" href="_static/logo.svg"/>
    <link rel="canonical" href="https://yihanwangastro.github.io/VegasAfterglow/docs/quickstart.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=01f34227"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/js/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VegasAfterglow
              <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#direct-model-calculation">Direct Model Calculation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#light-curve-calculation">Light Curve Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spectral-analysis">Spectral Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#internal-quantities-evolution">Internal Quantities Evolution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-setup-for-internal-analysis">Model Setup for Internal Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#accessing-simulation-quantities">Accessing Simulation Quantities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-parameter-evolution-visualization">Multi-Parameter Evolution Visualization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electron-energy-distribution-analysis">Electron Energy Distribution Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#synchrotron-frequency-evolution">Synchrotron Frequency Evolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#doppler-factor-spatial-distribution">Doppler Factor Spatial Distribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#equal-arrival-time-surface-visualization">Equal Arrival Time Surface Visualization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-estimation-with-mcmc">Parameter Estimation with MCMC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-data-and-configuring-the-model">Preparing Data and Configuring the Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-parameters-and-running-mcmc">Defining Parameters and Running MCMC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyzing-results-and-generating-predictions">Analyzing Results and Generating Predictions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcmc_fitting.html">MCMC Parameter Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_reference.html">Parameter Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Python API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_api.html">C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VegasAfterglow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Quickstart</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading"></a></h1>
<p>This guide will help you get started with VegasAfterglow quickly. We’ll cover basic installation, setting up a simple model, and running your first afterglow parameter estimation.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>The easiest way to install VegasAfterglow is via pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>VegasAfterglow
</pre></div>
</div>
<p>For more detailed installation instructions, see the <a class="reference internal" href="installation.html"><span class="doc">Installation</span></a> page.</p>
</section>
<section id="basic-usage">
<h2>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h2>
<p>VegasAfterglow is designed to efficiently model gamma-ray burst (GRB) afterglows and perform Markov Chain Monte Carlo (MCMC) parameter estimation.</p>
</section>
<section id="direct-model-calculation">
<h2>Direct Model Calculation<a class="headerlink" href="#direct-model-calculation" title="Link to this heading"></a></h2>
<p>Before diving into MCMC parameter estimation, you can directly use VegasAfterglow to generate light curves and spectra from a specific model. Let’s start by importing the necessary modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ISM</span><span class="p">,</span> <span class="n">TophatJet</span><span class="p">,</span> <span class="n">Observer</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Model</span>
</pre></div>
</div>
<p>Then, let’s set up the physical components of our afterglow model, including the environment, jet, observer, and radiation parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Define the circumburst environment (constant density ISM)</span>
<span class="n">medium</span> <span class="o">=</span> <span class="n">ISM</span><span class="p">(</span><span class="n">n_ism</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># in cgs unit</span>

<span class="c1"># 2. Configure the jet structure (top-hat with opening angle, energy, and Lorentz factor)</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TophatJet</span><span class="p">(</span><span class="n">theta_c</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span> <span class="c1"># in cgs unit</span>

<span class="c1"># 3. Set observer parameters (distance, redshift, viewing angle)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">(</span><span class="n">lumi_dist</span><span class="o">=</span><span class="mf">1e26</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta_obs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># in cgs unit</span>

<span class="c1"># 4. Define radiation microphysics parameters</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">)</span>

<span class="c1"># 5. Combine all components into a complete afterglow model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="n">medium</span><span class="o">=</span><span class="n">medium</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">forward_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">)</span>
</pre></div>
</div>
<section id="light-curve-calculation">
<h3>Light Curve Calculation<a class="headerlink" href="#light-curve-calculation" title="Link to this heading"></a></h3>
<p>Now, let’s compute and plot multi-wavelength light curves to see how the afterglow evolves over time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Create logarithmic time array from 10² to 10⁸ seconds (100s to ~3yrs)</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># 2. Define observing frequencies (radio, optical, X-ray bands in Hz)</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e14</span><span class="p">,</span> <span class="mf">1e17</span><span class="p">])</span>

<span class="c1"># 3. Calculate the afterglow emission at each time and frequency</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">specific_flux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>

<span class="c1"># 4. Visualize the multi-wavelength light curves</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.8</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># 5. Plot each frequency band</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;syn&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,:],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ Hz&#39;</span><span class="p">)</span>

<span class="c1"># 6. Add annotations for important transitions</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_note</span><span class="p">(</span><span class="n">plt</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;jet break&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">3e4</span><span class="p">,</span> <span class="mf">1e-26</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">3e3</span><span class="p">,</span> <span class="mf">5e-28</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\nu_m=\nu_a$&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">6e5</span><span class="p">,</span> <span class="mf">3e-25</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5e4</span><span class="p">,</span> <span class="mf">5e-24</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\nu=\nu_a$&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5e6</span><span class="p">,</span> <span class="mf">4e-25</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5e5</span><span class="p">,</span> <span class="mf">5e-24</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">))</span>

<span class="n">add_note</span><span class="p">(</span><span class="n">plt</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux Density (erg/cm²/s/Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Light Curves&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;assets/quick-lc.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/quick-lc.png"><img alt="_images/quick-lc.png" src="_images/quick-lc.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Running the light curve script will produce this figure showing the afterglow evolution across different frequencies.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="spectral-analysis">
<h3>Spectral Analysis<a class="headerlink" href="#spectral-analysis" title="Link to this heading"></a></h3>
<p>We can also examine how the broadband spectrum evolves at different times after the burst:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Define broad frequency range (10⁵ to 10²² Hz)</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># 2. Select specific time epochs for spectral snapshots</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mf">1e7</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">])</span>

<span class="c1"># 3. Calculate spectra at each epoch</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">specific_flux</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">)</span>

<span class="c1"># 4. Plot broadband spectra at each epoch</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.8</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">exp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">10</span><span class="o">**</span><span class="n">exp</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;syn&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">base</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> \times 10^</span><span class="se">{{</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="se">}}</span><span class="s1">$ s&#39;</span><span class="p">)</span>

<span class="c1"># 5. Add vertical lines marking the bands from the light curve plot</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux Density (erg/cm²/s/Hz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Synchrotron Spectra&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;assets/quick-spec.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="_images/quick-spec.png"><img alt="_images/quick-spec.png" src="_images/quick-spec.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">The spectral analysis code will generate this visualization showing spectra at different times, with vertical lines indicating the frequencies calculated in the light curve example.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="internal-quantities-evolution">
<h3>Internal Quantities Evolution<a class="headerlink" href="#internal-quantities-evolution" title="Link to this heading"></a></h3>
<p>VegasAfterglow provides comprehensive access to internal simulation quantities, allowing you to analyze the temporal evolution of physical parameters across different reference frames. This advanced feature enables detailed investigation of shock dynamics, microphysical parameters, and relativistic effects throughout the afterglow evolution.</p>
<section id="model-setup-for-internal-analysis">
<h4>Model Setup for Internal Analysis<a class="headerlink" href="#model-setup-for-internal-analysis" title="Link to this heading"></a></h4>
<p>Similar to the light curve generation, let’s set up the physical components of our afterglow model with additional resolution parameters for detailed internal tracking:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ISM</span><span class="p">,</span> <span class="n">TophatJet</span><span class="p">,</span> <span class="n">Observer</span><span class="p">,</span> <span class="n">Radiation</span><span class="p">,</span> <span class="n">Model</span>

<span class="n">medium</span> <span class="o">=</span> <span class="n">ISM</span><span class="p">(</span><span class="n">n_ism</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">jet</span> <span class="o">=</span> <span class="n">TophatJet</span><span class="p">(</span><span class="n">theta_c</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">E_iso</span><span class="o">=</span><span class="mf">1e52</span><span class="p">,</span> <span class="n">Gamma0</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">(</span><span class="n">lumi_dist</span><span class="o">=</span><span class="mf">1e26</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta_obs</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
<span class="n">rad</span> <span class="o">=</span> <span class="n">Radiation</span><span class="p">(</span><span class="n">eps_e</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">eps_B</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.3</span><span class="p">)</span>

<span class="c1"># Include resolution parameters for detailed internal tracking</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">,</span> <span class="n">medium</span><span class="o">=</span><span class="n">medium</span><span class="p">,</span> <span class="n">observer</span><span class="o">=</span><span class="n">obs</span><span class="p">,</span> <span class="n">forward_rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span> <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="accessing-simulation-quantities">
<h4>Accessing Simulation Quantities<a class="headerlink" href="#accessing-simulation-quantities" title="Link to this heading"></a></h4>
<p>Now, let’s access the internal simulation quantities using the <code class="docutils literal notranslate"><span class="pre">details</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the simulation details over a time range</span>
<span class="n">details</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="mf">1e0</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="mf">1e8</span><span class="p">)</span>

<span class="c1"># Print the keys of the internal quantities</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation details:&quot;</span><span class="p">,</span> <span class="n">details</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<p>You will get a comprehensive list of keys representing the internal quantities, such as <code class="docutils literal notranslate"><span class="pre">t_src</span></code>, <code class="docutils literal notranslate"><span class="pre">t_comv_fwd</span></code>, <code class="docutils literal notranslate"><span class="pre">t_obs_fwd</span></code>, and many more. The available quantities include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">phi</span></code>: 1D numpy array of azimuthal angles in radians</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta</span></code>: 1D numpy array of polar angles in radians</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t_src</span></code>: 3D numpy array of source frame times on coordinate (phi_i, theta_j, t_k) grid in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t_comv_fwd</span></code>: 3D numpy array of comoving times for the forward shock in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">t_obs_fwd</span></code>: 3D numpy array of observer times for the forward shock in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Gamma_fwd</span></code>: 3D numpy array of downstream Lorentz factors for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Gamma_th_fwd</span></code>: 3D numpy array of thermal Lorentz factors for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r_fwd</span></code>: 3D numpy array of lab frame radii in centimeters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">B_fwd</span></code>: 3D numpy array of downstream comoving magnetic field strengths for the forward shock in Gauss</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theta_fwd</span></code>: 3D numpy array of polar angles for the forward shock in radians</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N_p_fwd</span></code>: 3D numpy array of downstream shocked proton number per solid angle for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N_e_fwd</span></code>: 3D numpy array of downstream synchrotron electron number per solid angle for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gamma_a_fwd</span></code>: 3D numpy array of comoving frame self-absorption Lorentz factors for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gamma_m_fwd</span></code>: 3D numpy array of comoving frame injection Lorentz factors for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gamma_c_fwd</span></code>: 3D numpy array of comoving frame cooling Lorentz factors for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gamma_M_fwd</span></code>: 3D numpy array of comoving frame maximum Lorentz factors for the forward shock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nu_a_fwd</span></code>: 3D numpy array of comoving frame self-absorption frequencies for the forward shock in Hz</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nu_m_fwd</span></code>: 3D numpy array of comoving frame injection frequencies for the forward shock in Hz</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nu_c_fwd</span></code>: 3D numpy array of comoving frame cooling frequencies for the forward shock in Hz</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nu_M_fwd</span></code>: 3D numpy array of comoving frame maximum frequencies for the forward shock in Hz</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">I_nu_max_fwd</span></code>: 3D numpy array of comoving frame synchrotron maximum specific intensities for the forward shock in erg/cm²/s/Hz</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Doppler_fwd</span></code>: 3D numpy array of Doppler factors for the forward shock</p></li>
</ul>
</section>
<section id="multi-parameter-evolution-visualization">
<h4>Multi-Parameter Evolution Visualization<a class="headerlink" href="#multi-parameter-evolution-visualization" title="Link to this heading"></a></h4>
<p>To analyze the temporal evolution of physical parameters across different reference frames, we can visualize how key quantities evolve in the source frame, comoving frame, and observer frame. This code creates a comprehensive multi-panel figure displaying the temporal evolution of fundamental shock parameters across all three reference frames:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span><span class="p">[</span><span class="s1">&#39;Gamma_fwd&#39;</span><span class="p">,</span> <span class="s1">&#39;B_fwd&#39;</span><span class="p">,</span> <span class="s1">&#39;N_p_fwd&#39;</span><span class="p">,</span><span class="s1">&#39;r_fwd&#39;</span><span class="p">,</span><span class="s1">&#39;N_e_fwd&#39;</span><span class="p">,</span><span class="s1">&#39;P_nu_max_fwd&#39;</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$B^\prime$ [G]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$N_p$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$r$ [cm]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$N_e$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$P_{\nu, \rm max}^\prime$ [erg/s/Hz]&#39;</span><span class="p">]</span>

<span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t_src&#39;</span><span class="p">,</span> <span class="s1">&#39;t_comv_fwd&#39;</span><span class="p">,</span> <span class="s1">&#39;t_obs_fwd&#39;</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;source frame&#39;</span><span class="p">,</span> <span class="s1">&#39;comoving frame&#39;</span><span class="p">,</span> <span class="s1">&#39;observer frame&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;C2&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$t_{\rm src}$ [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t^\prime$ [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t_{\rm obs}$ [s]&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mf">4.2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span> <span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)))</span>

<span class="c1">#plot the evolution of various parameters for phi = 0 and theta = 0 (so the first two indexes are 0)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;shock_quantities.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="_images/shock_quantities.png"><img alt="_images/shock_quantities.png" src="_images/shock_quantities.png" style="width: 1000px;" />
</a>
<figcaption>
<p><span class="caption-text">Multi-parameter evolution showing fundamental shock parameters across three reference frames.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="electron-energy-distribution-analysis">
<h4>Electron Energy Distribution Analysis<a class="headerlink" href="#electron-energy-distribution-analysis" title="Link to this heading"></a></h4>
<p>This visualization focuses specifically on the characteristic electron energies (self-absorption, injection, and cooling) in both the comoving frame and observer frame, illustrating the relativistic transformation effects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t_src&#39;</span><span class="p">,</span> <span class="s1">&#39;t_comv_fwd&#39;</span><span class="p">,</span> <span class="s1">&#39;t_obs_fwd&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$t_{\rm src}$ [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t^\prime$ [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t_{\rm obs}$ [s]&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mf">4.2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span> <span class="mf">3.6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;gamma_a_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\gamma_a^\prime$&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;gamma_m_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\gamma_m^\prime$&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;gamma_c_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\gamma_c^\prime$&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;gamma_a_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\gamma_a$&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;gamma_m_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\gamma_m$&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;gamma_c_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\gamma_c$&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\gamma_e^\prime$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;electron_quantities.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="_images/electron_quantities.png"><img alt="_images/electron_quantities.png" src="_images/electron_quantities.png" style="width: 1000px;" />
</a>
<figcaption>
<p><span class="caption-text">Evolution of characteristic electron energies showing relativistic transformation effects.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="synchrotron-frequency-evolution">
<h4>Synchrotron Frequency Evolution<a class="headerlink" href="#synchrotron-frequency-evolution" title="Link to this heading"></a></h4>
<p>This analysis tracks the evolution of characteristic synchrotron frequencies, demonstrating how the spectral break frequencies change over time and how Doppler boosting affects the observed spectrum:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t_src&#39;</span><span class="p">,</span> <span class="s1">&#39;t_comv_fwd&#39;</span><span class="p">,</span> <span class="s1">&#39;t_obs_fwd&#39;</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$t_{\rm src}$ [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t^\prime$ [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$t_{\rm obs}$ [s]&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mf">4.2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span> <span class="mf">3.6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;nu_a_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\nu_a^\prime$&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;nu_m_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\nu_m^\prime$&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;nu_c_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\nu_c^\prime$&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;nu_a_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\nu_a$&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;nu_m_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\nu_m$&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;yellowgreen&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="n">frame</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;nu_c_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\nu_c$&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\nu$ [Hz]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;photon_quantities.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="_images/photon_quantities.png"><img alt="_images/photon_quantities.png" src="_images/photon_quantities.png" style="width: 1000px;" />
</a>
<figcaption>
<p><span class="caption-text">Evolution of characteristic synchrotron frequencies showing spectral break evolution and Doppler effects.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="doppler-factor-spatial-distribution">
<h4>Doppler Factor Spatial Distribution<a class="headerlink" href="#doppler-factor-spatial-distribution" title="Link to this heading"></a></h4>
<p>This polar plot visualizes the spatial distribution of the Doppler factor across the jet structure, showing how relativistic beaming varies with angular position and radial distance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;theta_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">r</span>     <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;r_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">D</span>     <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;Doppler_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>

<span class="c1"># Polar contour plot</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_rscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">true_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">true_ticks</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">true_ticks</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ [rad]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r$ [cm]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1"> D$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;doppler.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="_images/doppler.png"><img alt="_images/doppler.png" src="_images/doppler.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Spatial distribution of Doppler factor showing relativistic beaming effects across the jet structure.</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="equal-arrival-time-surface-visualization">
<h4>Equal Arrival Time Surface Visualization<a class="headerlink" href="#equal-arrival-time-surface-visualization" title="Link to this heading"></a></h4>
<p>This final visualization maps the equal arrival time surfaces in polar coordinates, illustrating how light from different parts of the jet reaches the observer at the same time, which is crucial for understanding light curve morphology:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;theta_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">r</span>     <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;r_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="n">t_obs</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="s1">&#39;t_obs_fwd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:]</span>

<span class="n">scale</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t_obs</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_rscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">true_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">true_ticks</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">true_ticks</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="o">*</span><span class="n">scale</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ [rad]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r$ [cm]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1"> (t_{\rm obs}/s)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;EAT.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="_images/EAT.png"><img alt="_images/EAT.png" src="_images/EAT.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Equal arrival time surfaces showing how light travel time effects determine light curve morphology.</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>These examples demonstrate VegasAfterglow’s comprehensive capability for analyzing internal quantities and understanding the underlying physics of GRB afterglows. The detailed access to microphysical parameters enables advanced studies of shock dynamics, relativistic effects, and radiation mechanisms across different reference frames.</p>
</section>
</section>
</section>
<section id="parameter-estimation-with-mcmc">
<h2>Parameter Estimation with MCMC<a class="headerlink" href="#parameter-estimation-with-mcmc" title="Link to this heading"></a></h2>
<p>For more advanced analysis, VegasAfterglow provides powerful MCMC capabilities to fit model parameters to observational data.</p>
<p>First, let’s import the necessary modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">corner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">VegasAfterglow</span><span class="w"> </span><span class="kn">import</span> <span class="n">ObsData</span><span class="p">,</span> <span class="n">Setups</span><span class="p">,</span> <span class="n">Fitter</span><span class="p">,</span> <span class="n">ParamDef</span><span class="p">,</span> <span class="n">Scale</span>
</pre></div>
</div>
<section id="preparing-data-and-configuring-the-model">
<h3>Preparing Data and Configuring the Model<a class="headerlink" href="#preparing-data-and-configuring-the-model" title="Link to this heading"></a></h3>
<p>VegasAfterglow provides flexible options for loading observational data through the <code class="docutils literal notranslate"><span class="pre">ObsData</span></code> class. You can add light curves (specific flux vs. time) and spectra (specific flux vs. frequency) in multiple ways:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance to store observational data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ObsData</span><span class="p">()</span>

<span class="c1"># Method 1: Add data directly from lists or numpy arrays</span>

<span class="c1"># For light curves</span>
<span class="n">t_data</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e3</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">,</span> <span class="mf">5e3</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">]</span>  <span class="c1"># Time in seconds</span>
<span class="n">flux_data</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-26</span><span class="p">,</span> <span class="mf">8e-27</span><span class="p">,</span> <span class="mf">5e-27</span><span class="p">,</span> <span class="mf">3e-27</span><span class="p">,</span> <span class="mf">2e-27</span><span class="p">]</span>  <span class="c1"># Specific flux in erg/cm²/s/Hz</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-28</span><span class="p">,</span> <span class="mf">8e-28</span><span class="p">,</span> <span class="mf">5e-28</span><span class="p">,</span> <span class="mf">3e-28</span><span class="p">,</span> <span class="mf">2e-28</span><span class="p">]</span>  <span class="c1"># Specific flux error in erg/cm²/s/Hz</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_light_curve</span><span class="p">(</span><span class="n">nu_cgs</span><span class="o">=</span><span class="mf">4.84e14</span><span class="p">,</span> <span class="n">t_cgs</span><span class="o">=</span><span class="n">t_data</span><span class="p">,</span> <span class="n">Fnu_cgs</span><span class="o">=</span><span class="n">flux_data</span><span class="p">,</span> <span class="n">Fnu_err</span><span class="o">=</span><span class="n">flux_err</span><span class="p">)</span>
<span class="c1"># You can also assign weights to each data point to account for systematic uncertainties or correlations. You don&#39;t need to worry about the weights&#39; normalization, the code will normalize them automatically.</span>
<span class="c1">#data.add_light_curve(nu_cgs=4.84e14, t_cgs=t_data, Fnu_cgs=flux_data, Fnu_err=flux_err, weights=np.ones(len(t_data)))</span>

<span class="c1"># For spectra</span>
<span class="n">nu_data</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>  <span class="c1"># Frequencies in Hz</span>
<span class="n">spectrum_data</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="c1"># Specific flux values in erg/cm²/s/Hz</span>
<span class="n">spectrum_err</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>   <span class="c1"># Specific flux errors in erg/cm²/s/Hz</span>
<span class="n">data</span><span class="o">.</span><span class="n">add_spectrum</span><span class="p">(</span><span class="n">t_cgs</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">nu_cgs</span><span class="o">=</span><span class="n">nu_data</span><span class="p">,</span> <span class="n">Fnu_cgs</span><span class="o">=</span><span class="n">spectrum_data</span><span class="p">,</span> <span class="n">Fnu_err</span><span class="o">=</span><span class="n">spectrum_err</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Method 2: Load from CSV files</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ObsData</span><span class="p">()</span>
<span class="c1"># Define your bands and files</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.4e17</span><span class="p">,</span> <span class="mf">4.84e14</span><span class="p">,</span> <span class="mf">1.4e14</span><span class="p">]</span>  <span class="c1"># Example: X-ray, optical R-band</span>
<span class="n">lc_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;data/ep.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;data/r.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;data/vt-r.csv&quot;</span><span class="p">]</span>

<span class="c1"># Load light curves from files</span>
<span class="k">for</span> <span class="n">nu</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">lc_files</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">add_light_curve</span><span class="p">(</span><span class="n">nu_cgs</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span> <span class="n">t_cgs</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span> <span class="n">Fnu_cgs</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_obs&quot;</span><span class="p">],</span> <span class="n">Fnu_err</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_err&quot;</span><span class="p">])</span>

<span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3000</span><span class="p">]</span> <span class="c1"># Example: time in seconds</span>
<span class="n">spec_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;data/ep-spec.csv&quot;</span><span class="p">]</span>

<span class="c1"># Load spectra from files</span>
<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">spec_files</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">add_spectrum</span><span class="p">(</span><span class="n">t_cgs</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">nu_cgs</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">],</span> <span class="n">Fnu_cgs</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_obs&quot;</span><span class="p">],</span> <span class="n">Fnu_err</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_err&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ObsData</span></code> interface is designed to be flexible. You can mix and match different data sources, and add multiple light curves at different frequencies as well as multiple spectra at different times.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Setups</span></code> class defines the global properties and environment for your model. These settings remain fixed during the MCMC process:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span> <span class="o">=</span> <span class="n">Setups</span><span class="p">()</span>

<span class="c1"># Source properties</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">lumi_dist</span> <span class="o">=</span> <span class="mf">3.364e28</span>    <span class="c1"># Luminosity distance [cm]</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">1.58</span>               <span class="c1"># Redshift</span>

<span class="c1"># Physical model configuration</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">medium</span> <span class="o">=</span> <span class="s2">&quot;wind&quot;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">jet</span> <span class="o">=</span> <span class="s2">&quot;powerlaw&quot;</span>
</pre></div>
</div>
<p>These settings affect how the model is calculated but are not varied during the MCMC process.</p>
</section>
<section id="defining-parameters-and-running-mcmc">
<h3>Defining Parameters and Running MCMC<a class="headerlink" href="#defining-parameters-and-running-mcmc" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">ParamDef</span></code> class is used to define the parameters for MCMC exploration. Each parameter requires a name, prior range, and sampling scale:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mc_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;E_iso&quot;</span><span class="p">,</span>   <span class="mf">1e50</span><span class="p">,</span>  <span class="mf">1e54</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>       <span class="c1"># Isotropic energy [erg]</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;Gamma0&quot;</span><span class="p">,</span>     <span class="mi">5</span><span class="p">,</span>  <span class="mi">1000</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>       <span class="c1"># Lorentz factor at the core</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_c&quot;</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>    <span class="c1"># Core half-opening angle [rad]</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;theta_v&quot;</span><span class="p">,</span>  <span class="mf">0.0</span><span class="p">,</span>   <span class="mf">0.0</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">FIXED</span><span class="p">),</span>     <span class="c1"># Viewing angle [rad]</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>          <span class="mi">2</span><span class="p">,</span>     <span class="mi">3</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">),</span>    <span class="c1"># Shocked electron power law index</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_e&quot;</span><span class="p">,</span>   <span class="mf">1e-2</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>       <span class="c1"># Electron energy fraction</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;eps_B&quot;</span><span class="p">,</span>   <span class="mf">1e-4</span><span class="p">,</span>   <span class="mf">0.5</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>       <span class="c1"># Magnetic field energy fraction</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;A_star&quot;</span><span class="p">,</span>  <span class="mf">1e-3</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>       <span class="c1"># Wind parameter</span>
    <span class="n">ParamDef</span><span class="p">(</span><span class="s2">&quot;xi_e&quot;</span><span class="p">,</span>    <span class="mf">1e-3</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>  <span class="n">Scale</span><span class="o">.</span><span class="n">LOG</span><span class="p">),</span>       <span class="c1"># Electron acceleration fraction</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="simple">
<dt><strong>Scale Types:</strong></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Scale.LOG</span></code>: Sample in logarithmic space (log10) - ideal for parameters spanning multiple orders of magnitude</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Scale.LINEAR</span></code>: Sample in linear space - appropriate for parameters with narrower ranges</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Scale.FIXED</span></code>: Keep parameter fixed at the initial value - use for parameters you don’t want to vary</p></li>
</ul>
</dd>
</dl>
<p><strong>Parameter Choices:</strong>
The parameters you include depend on your model configuration:</p>
<blockquote>
<div><ul class="simple">
<li><p>For “wind” medium: use <code class="docutils literal notranslate"><span class="pre">A_star</span></code> parameter</p></li>
<li><p>For “ISM” medium: use <code class="docutils literal notranslate"><span class="pre">n_ism</span></code> parameter instead</p></li>
<li><p>Different jet structures may require different parameters</p></li>
</ul>
</div></blockquote>
<p>Initialize the <code class="docutils literal notranslate"><span class="pre">Fitter</span></code> class with your data and configuration, then run the MCMC process:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the fitter object</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">Fitter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>

<span class="c1"># Run the MCMC fitting</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">param_defs</span><span class="o">=</span><span class="n">mc_params</span><span class="p">,</span>          <span class="c1"># Parameter definitions</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>        <span class="c1"># Grid resolution (see more details in `Examples`)</span>
    <span class="n">total_steps</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>             <span class="c1"># Total number of MCMC steps</span>
    <span class="n">burn_frac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>                 <span class="c1"># Fraction of steps to discard as burn-in</span>
    <span class="n">thin</span><span class="o">=</span><span class="mi">1</span>                         <span class="c1"># Thinning factor</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">result</span></code> object contains:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">samples</span></code>: The MCMC chain samples (posterior distribution)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">labels</span></code>: Parameter names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">best_params</span></code>: Maximum likelihood parameter values</p></li>
</ul>
</dd>
</dl>
</section>
<section id="analyzing-results-and-generating-predictions">
<h3>Analyzing Results and Generating Predictions<a class="headerlink" href="#analyzing-results-and-generating-predictions" title="Link to this heading"></a></h3>
<p>Check the best-fit parameters and their uncertainties:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print best-fit parameters (maximum likelihood)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best-fit parameters:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">best_params</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Compute median and credible intervals</span>
<span class="n">flat_chain</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">medians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parameter constraints (median and 68</span><span class="si">% c</span><span class="s2">redible intervals):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">medians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (+</span><span class="si">{</span><span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">medians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, -</span><span class="si">{</span><span class="n">medians</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the best-fit parameters to generate model predictions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define time and frequency ranges for predictions</span>
<span class="n">t_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.4e17</span><span class="p">,</span> <span class="mf">4.84e14</span><span class="p">,</span> <span class="mf">1.4e14</span><span class="p">]</span>

<span class="c1"># Generate light curves with the best-fit model</span>
<span class="n">lc_best</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">specific_flux</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">best_params</span><span class="p">,</span> <span class="n">t_out</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>

<span class="n">nu_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3000</span><span class="p">]</span>
<span class="c1"># Generate model spectra at the specified times using the best-fit parameters</span>
<span class="n">spec_best</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">specific_flux</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">best_params</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">nu_out</span><span class="p">)</span>
</pre></div>
</div>
<p>Now you can plot the best-fit model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_bestfit</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">lc_fit</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">spec_fit</span><span class="p">):</span>
    <span class="c1"># Create figure with two subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">))</span>

    <span class="c1"># Plot light curves</span>
    <span class="n">shifts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lc_files</span><span class="p">)):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">lc_files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_obs&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_err&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lc_files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lc_fit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Plot spectra</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_files</span><span class="p">)):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">spec_files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_obs&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Fv_err&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">spec_files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Configure axes</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">ax1</span><span class="p">,</span> <span class="s1">&#39;t [s]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$F_\nu$ [erg/cm$^2$/s/Hz]&#39;</span><span class="p">),</span>
                              <span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\nu$ [Hz]&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$F_\nu$ [erg/cm$^2$/s/Hz]&#39;</span><span class="p">)]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">draw_bestfit</span><span class="p">(</span><span class="n">t_out</span><span class="p">,</span> <span class="n">lc_best</span><span class="p">,</span> <span class="n">nu_out</span><span class="p">,</span> <span class="n">spec_best</span><span class="p">)</span>
</pre></div>
</div>
<p>Corner plots are essential for visualizing parameter correlations and posterior distributions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_corner</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;corner_plot.png&quot;</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span>
        <span class="n">flat_chain</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>  <span class="c1"># For median and ±1σ</span>
        <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span>
        <span class="n">label_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">},</span>
        <span class="n">truths</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>  <span class="c1"># Show median values</span>
        <span class="n">truth_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">fill_contours</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">],</span>  <span class="c1"># 1σ and 2σ contours</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1"># Create the corner plot</span>
<span class="n">flat_chain</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plot_corner</span><span class="p">(</span><span class="n">flat_chain</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>See the <a class="reference internal" href="examples.html"><span class="doc">Examples</span></a> page for more detailed examples</p></li>
<li><p>Check the <a class="reference internal" href="parameter_reference.html"><span class="doc">Parameter Reference</span></a> for comprehensive parameter documentation</p></li>
<li><p>Visit the <a class="reference internal" href="troubleshooting.html"><span class="doc">Troubleshooting</span></a> page if you encounter any issues</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, VegasAfterglow Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>